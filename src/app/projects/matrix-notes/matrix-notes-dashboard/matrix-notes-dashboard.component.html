<div class="matrix-dashboard-container" *ngIf="adminService.isAdmin$ | async">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col">
          <div class="header-content">
            <div class="header-icon">
              <i class="fas fa-book-open"></i>
            </div>
            <div>
              <h1 class="header-title">Matrix Notes</h1>
              <p class="header-subtitle">Manage educational tutorials and learning content</p>
            </div>
          </div>
        </div>
        <div class="col-auto">
          <!-- Database Connection Status -->
          <div class="connection-status" [class]="getConnectionStatusClass()">
            <i [class]="getConnectionIcon()"></i>
            <span class="status-text">{{ getConnectionStatusText() }}</span>
            <button *ngIf="connectionStatus === 'disconnected'" 
                    class="btn-retry" 
                    (click)="retryConnection()"
                    title="Retry Connection">
              <i class="fas fa-redo"></i>
            </button>
          </div>
          
          <button class="btn btn-primary btn-create" (click)="createNewTutorial()">
            <i class="fas fa-plus me-2"></i>New Tutorial
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dashboard-content">
    <div class="container-fluid">
      
      <!-- Statistics Overview -->
      <div class="stats-section">
        <div class="row g-4">
          <div class="col-xl-3 col-md-6">
            <div class="stat-card total">
              <div class="stat-content">
                <div class="stat-icon">
                  <i class="fas fa-book"></i>
                </div>
                <div class="stat-info">
                  <h3 class="stat-value">{{ stats.total }}</h3>
                  <p class="stat-label">Total Tutorials</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6">
            <div class="stat-card published">
              <div class="stat-content">
                <div class="stat-icon">
                  <i class="fas fa-eye"></i>
                </div>
                <div class="stat-info">
                  <h3 class="stat-value">{{ stats.published }}</h3>
                  <p class="stat-label">Published</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6">
            <div class="stat-card draft">
              <div class="stat-content">
                <div class="stat-icon">
                  <i class="fas fa-edit"></i>
                </div>
                <div class="stat-info">
                  <h3 class="stat-value">{{ stats.draft }}</h3>
                  <p class="stat-label">Drafts</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6">
            <div class="stat-card featured">
              <div class="stat-content">
                <div class="stat-icon">
                  <i class="fas fa-star"></i>
                </div>
                <div class="stat-info">
                  <h3 class="stat-value">{{ getTotalViews() }}</h3>
                  <p class="stat-label">Total Views</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Connection Error Banner -->
      <div *ngIf="connectionStatus === 'disconnected'" class="connection-error-banner">
        <div class="error-content">
          <i class="fas fa-exclamation-triangle"></i>
          <div class="error-text">
            <strong>Database Connection Lost</strong>
            <span>Unable to connect to the database. Some features may not work properly.</span>
          </div>
          <button class="btn btn-sm btn-outline-light" (click)="retryConnection()">
            <i class="fas fa-redo me-1"></i>Retry Connection
          </button>
        </div>
      </div>

      <!-- Filters Section -->
      <div class="filters-section" *ngIf="connectionStatus === 'connected'">
        <div class="filter-card">
          <div class="filter-header">
            <h5 class="filter-title">
              <i class="fas fa-filter me-2"></i>
              Filter Tutorials
            </h5>
          </div>
          <div class="filter-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-4">
                <label class="form-label">Search Tutorials</label>
                <div class="search-input-group">
                  <span class="search-icon">
                    <i class="fas fa-search"></i>
                  </span>
                  <input
                    type="text"
                    class="form-control search-input"
                    placeholder="Search by title, description, or tags..."
                    [(ngModel)]="searchTerm"
                    (input)="onSearchChange(searchTerm)"
                  >
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Category</label>
                <select class="form-select" [(ngModel)]="selectedCategory" (change)="onCategoryChange(selectedCategory)">
                  <option *ngFor="let cat of categories" [value]="cat.value">
                    {{ cat.label }}
                  </option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Status</label>
                <select class="form-select" [(ngModel)]="selectedStatus" (change)="onStatusChange(selectedStatus)">
                  <option *ngFor="let status of statuses" [value]="status.value">
                    {{ status.label }}
                  </option>
                </select>
              </div>
              <div class="col-md-2">
                <button class="btn btn-clear-filters" (click)="clearFilters()">
                  <i class="fas fa-times me-1"></i>Clear
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tutorials List -->
      <div class="tutorials-section" *ngIf="connectionStatus === 'connected'">
        <div class="tutorials-card">
          <div class="tutorials-header">
            <div class="tutorials-title-section">
              <h5 class="tutorials-title">
                <i class="fas fa-list me-2"></i>
                Tutorials
              </h5>
              <span class="tutorials-count">{{ filteredTutorials.length }} items</span>
            </div>
          </div>
          
          <div class="tutorials-body">
            <!-- Loading State -->
            <div *ngIf="isLoading" class="loading-state">
              <div class="spinner-container">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="loading-text">Loading tutorials...</p>
              </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="!isLoading && filteredTutorials.length === 0" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-book-open"></i>
              </div>
              <h5 class="empty-title">No tutorials found</h5>
              <p class="empty-description">No tutorials match your current filters.</p>
              <button class="btn btn-primary" (click)="createNewTutorial()">
                <i class="fas fa-plus me-1"></i>Create First Tutorial
              </button>
            </div>

            <!-- Tutorials Grid -->
            <div *ngIf="!isLoading && filteredTutorials.length > 0" class="tutorials-grid">
              <div *ngFor="let tutorial of filteredTutorials" class="tutorial-card" [class.published]="tutorial.published">
                <div class="card-header">
                  <div class="status-indicator" [class.published]="tutorial.published"></div>
                  <div class="card-actions">
                    <button class="btn-action btn-edit" (click)="editTutorial(tutorial.id)" title="Edit">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-toggle" 
                            (click)="togglePublish(tutorial)" 
                            [title]="tutorial.published ? 'Unpublish' : 'Publish'">
                      <i class="fas" [class.fa-eye]="!tutorial.published" [class.fa-eye-slash]="tutorial.published"></i>
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteTutorial(tutorial)" title="Delete">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>

                <div class="card-body">
                  <div class="tutorial-category">
                    <span class="category-badge">{{ tutorial.category }}</span>
                  </div>
                  
                  <h3 class="tutorial-title">{{ tutorial.title || 'Untitled Tutorial' }}</h3>
                  
                  <p class="tutorial-description">
                    {{ tutorial.description || 'No description provided' }}
                  </p>

                  <div class="tutorial-meta">
                    <div class="meta-item">
                      <i class="fas fa-signal"></i>
                      <span class="difficulty-badge" [class]="tutorial.difficulty">
                        {{ tutorial.difficulty | titlecase }}
                      </span>
                    </div>
                    <div class="meta-item">
                      <i class="fas fa-clock"></i>
                      <span>{{ tutorial.readingTime }} min</span>
                    </div>
                    <div class="meta-item">
                      <i class="fas fa-calendar"></i>
                      <span>{{ tutorial.createdAt | date:'MMM dd' }}</span>
                    </div>
                  </div>
                </div>

                <div class="card-footer">
                  <div class="engagement-stats">
                    <div class="stat">
                      <i class="fas fa-eye"></i>
                      <span>{{ tutorial.views || 0 }}</span>
                    </div>
                    <div class="stat">
                      <i class="fas fa-heart"></i>
                      <span>{{ tutorial.likes || 0 }}</span>
                    </div>
                    <div class="stat">
                      <i class="fas fa-bookmark"></i>
                      <span>{{ tutorial.bookmarks?.length || 0 }}</span>
                    </div>
                  </div>
                  <button class="btn-view" (click)="previewTutorial(tutorial.id)">
                    <i class="fas fa-external-link-alt"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Disconnected State -->
      <div *ngIf="connectionStatus === 'disconnected' && !isLoading" class="disconnected-state">
        <div class="disconnected-content">
          <div class="disconnected-icon">
            <i class="fas fa-database"></i>
          </div>
          <h5 class="disconnected-title">Database Connection Required</h5>
          <p class="disconnected-description">
            Unable to connect to the database. Please check your internet connection and try again.
          </p>
          <button class="btn btn-primary" (click)="retryConnection()">
            <i class="fas fa-redo me-1"></i>Retry Connection
          </button>
        </div>
      </div>
    </div>
  </div>
</div>