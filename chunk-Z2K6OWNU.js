import{h as k,l,m as S,p as f,q as g,r as c,s as v,t as y,v as $,w as F,x as T,y as m,z as p}from"./chunk-AIE5RIAU.js";import{U as w,_ as h}from"./chunk-DIH7HWWK.js";import{c as b,f as n}from"./chunk-CWTPBX7D.js";var q=(()=>{class d{firestore=h(S);toastr=h(k);constructor(){console.log("\u{1F504} MatrixNotesService initialized - Using Firebase only")}generateId(){return"tut_"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}getCurrentUserId(){return"admin"}cleanData(t){if(t==null)return null;if(Array.isArray(t))return t.map(e=>this.cleanData(e)).filter(e=>e!=null);if(typeof t=="object"&&!(t instanceof Date)&&!(t instanceof l)){let e={};for(let[s,o]of Object.entries(t)){let r=this.cleanData(o);r!=null&&(e[s]=r)}return Object.keys(e).length>0?e:null}return t}convertToDate(t){return t instanceof l?t.toDate():t instanceof Date?t:typeof t=="string"?new Date(t):new Date}getAllTutorials(){return n(this,null,function*(){try{console.log("\u{1F504} Fetching all tutorials from Firebase...");let t=f(this.firestore,"tutorials"),e=T(t,F("createdAt","desc")),s=yield y(e),o=[];return s.forEach(r=>{try{let i=r.data(),u=this.firestoreToTutorial(r.id,i);i.roadmapStep!==void 0&&(u.roadmapStep=Number(i.roadmapStep)),o.push(u)}catch(i){console.error(`\u274C Error processing tutorial ${r.id}:`,i)}}),console.log(`\u2705 Fetched ${o.length} tutorials from Firebase`),o}catch(t){throw console.error("\u274C Error fetching tutorials:",t),t}})}getPublishedTutorials(){return n(this,null,function*(){try{let e=(yield this.getAllTutorials()).filter(s=>s.published);return console.log(`\u2705 Found ${e.length} published tutorials`),e}catch(t){throw console.error("\u274C Error fetching published tutorials:",t),t}})}getTutorial(t){return n(this,null,function*(){try{console.log(`\u{1F504} Fetching tutorial: ${t}`);let e=c(this.firestore,"tutorials",t),s=yield v(e);if(!s.exists())return console.log(`\u274C Tutorial not found: ${t}`),null;let o=this.firestoreToTutorial(s.id,s.data());return console.log(`\u2705 Tutorial fetched successfully: ${o.title}`),o}catch(e){throw console.error(`\u274C Error fetching tutorial ${t}:`,e),this.toastr.error(`Failed to fetch tutorial: ${e.message}`),e}})}updateTutorial(t,e){return n(this,null,function*(){try{console.log(`\u{1F504} Updating tutorial: ${t}`);let s=e,{id:o}=s,r=b(s,["id"]),i={updatedAt:l.fromDate(new Date)};r.title!==void 0&&(i.title=r.title),r.description!==void 0&&(i.description=r.description),r.content!==void 0&&(i.content=r.content),r.tags!==void 0&&(i.tags=r.tags),r.category!==void 0&&(i.category=r.category),r.published!==void 0&&(i.published=r.published),r.featured!==void 0&&(i.featured=r.featured),r.readingTime!==void 0&&(i.readingTime=r.readingTime),r.difficulty!==void 0&&(i.difficulty=r.difficulty),r.views!==void 0&&(i.views=r.views),r.likes!==void 0&&(i.likes=r.likes),r.roadmapStep!==void 0&&(i.roadmapStep=r.roadmapStep),r.technologies!==void 0&&(i.technologies=r.technologies),r.prerequisites!==void 0&&(i.prerequisites=r.prerequisites),r.learningObjectives!==void 0&&(i.learningObjectives=r.learningObjectives);let u=this.cleanData(i);console.log("\u{1F4DD} Updating tutorial with data:",u);let a=c(this.firestore,"tutorials",t);yield p(a,u),console.log(`\u2705 Tutorial updated successfully: ${t}`),this.toastr.success("Tutorial updated successfully")}catch(o){throw console.error(`\u274C Error updating tutorial ${t}:`,o),this.toastr.error(`Failed to update tutorial: ${o.message}`),o}})}deleteTutorial(t){return n(this,null,function*(){try{console.log(`\u{1F504} Deleting tutorial: ${t}`);let e=c(this.firestore,"tutorials",t);yield g(e),console.log(`\u2705 Tutorial deleted successfully: ${t}`),this.toastr.success("Tutorial deleted successfully")}catch(e){throw console.error(`\u274C Error deleting tutorial ${t}:`,e),this.toastr.error(`Failed to delete tutorial: ${e.message}`),e}})}publishTutorial(t){return n(this,null,function*(){try{console.log(`\u{1F504} Publishing tutorial: ${t}`);let e=c(this.firestore,"tutorials",t);yield p(e,{published:!0,publishedAt:l.fromDate(new Date),updatedAt:l.fromDate(new Date)}),console.log(`\u2705 Tutorial published successfully: ${t}`),this.toastr.success("Tutorial published successfully")}catch(e){throw console.error(`\u274C Error publishing tutorial ${t}:`,e),this.toastr.error(`Failed to publish tutorial: ${e.message}`),e}})}unpublishTutorial(t){return n(this,null,function*(){try{console.log(`\u{1F504} Unpublishing tutorial: ${t}`);let e=c(this.firestore,"tutorials",t);yield p(e,{published:!1,updatedAt:l.fromDate(new Date)}),console.log(`\u2705 Tutorial unpublished successfully: ${t}`),this.toastr.success("Tutorial unpublished successfully")}catch(e){throw console.error(`\u274C Error unpublishing tutorial ${t}:`,e),this.toastr.error(`Failed to unpublish tutorial: ${e.message}`),e}})}incrementViews(t){return n(this,null,function*(){try{let e=yield this.getTutorial(t);e&&(yield this.updateTutorial(t,{views:(e.views||0)+1}))}catch(e){console.error("Error incrementing views:",e)}})}incrementLikes(t){return n(this,null,function*(){try{let e=yield this.getTutorial(t);e&&(yield this.updateTutorial(t,{likes:(e.likes||0)+1}))}catch(e){console.error("Error incrementing likes:",e)}})}getTutorialsByRoadmapStep(t){return n(this,null,function*(){try{console.log(`\u{1F504} Fetching tutorials for step ${t}`);let s=(yield this.getAllTutorials()).filter(o=>{let r=o.roadmapStep===t,i=o.published===!0;return r&&i});return s.sort((o,r)=>o.topicOrder&&r.topicOrder?o.topicOrder-r.topicOrder:new Date(o.createdAt).getTime()-new Date(r.createdAt).getTime()),console.log(`\u2705 Found ${s.length} tutorials for step ${t}`),s}catch(e){throw console.error(`\u274C Error fetching tutorials for roadmap step ${t}:`,e),e}})}getTutorialByRoadmapStep(t){return n(this,null,function*(){try{let e=yield this.getTutorialsByRoadmapStep(t);return e.length>0?e[0]:null}catch(e){return console.error(`\u274C Error getting tutorial for roadmap step ${t}:`,e),null}})}firestoreToTutorial(t,e){return{id:t,title:e.title||"Untitled Tutorial",description:e.description||"",content:e.content||[],tags:e.tags||[],category:e.category||"general",author:e.author||this.getCurrentUserId(),published:e.published||!1,featured:e.featured||!1,createdAt:this.convertToDate(e.createdAt),updatedAt:this.convertToDate(e.updatedAt),readingTime:e.readingTime||5,difficulty:e.difficulty||"beginner",bookmarks:e.bookmarks||[],views:e.views||0,likes:e.likes||0,roadmapStep:e.roadmapStep||void 0,roadmapType:e.roadmapType||void 0,stepTitle:e.stepTitle||void 0,technologies:e.technologies||[],prerequisites:e.prerequisites||[],learningObjectives:e.learningObjectives||[]}}createTutorial(t){return n(this,null,function*(){try{let e=this.generateId(),s=t.roadmapStep?Number(t.roadmapStep):void 0,o={id:e,title:t.title||"Untitled Tutorial",description:t.description||"",content:t.content||[],tags:t.tags||[],category:t.category||"general",author:t.author||this.getCurrentUserId(),published:t.published||!1,featured:t.featured||!1,createdAt:new Date,updatedAt:new Date,readingTime:t.readingTime||5,difficulty:t.difficulty||"beginner",bookmarks:t.bookmarks||[],views:t.views||0,likes:t.likes||0,roadmapStep:s,roadmapType:t.roadmapType,stepTitle:t.stepTitle,technologies:t.technologies||[],prerequisites:t.prerequisites||[],learningObjectives:t.learningObjectives||[]},r={title:o.title,description:o.description,content:o.content.map(a=>({id:a.id||this.generateId(),type:a.type||"text",content:a.content||"",order:a.order||0,language:a.language||"",fileName:a.fileName||"",caption:a.caption||"",title:a.title||"",metadata:a.metadata||{},showPreview:a.showPreview||!1})),tags:o.tags,category:o.category,author:o.author,published:o.published,featured:o.featured,createdAt:l.fromDate(o.createdAt),updatedAt:l.fromDate(o.updatedAt),readingTime:o.readingTime,difficulty:o.difficulty,bookmarks:o.bookmarks,views:o.views,likes:o.likes,roadmapStep:s,roadmapType:o.roadmapType,stepTitle:o.stepTitle,technologies:o.technologies,prerequisites:o.prerequisites,learningObjectives:o.learningObjectives},i=this.cleanData(r),u=c(this.firestore,"tutorials",e);return yield m(u,i),console.log("\u2705 Tutorial created with roadmap step:",s),this.toastr.success("Tutorial created successfully"),e}catch(e){throw console.error("\u274C Error creating tutorial:",e),this.toastr.error(`Failed to create tutorial: ${e.message}`),e}})}hasTutorialForStep(t){return n(this,null,function*(){try{return(yield this.getTutorialsByRoadmapStep(t)).length>0}catch(e){return console.error(`\u274C Error checking tutorial for step ${t}:`,e),!1}})}getRoadmapStepsWithTutorials(){return n(this,null,function*(){try{let t=[1,2,3,4,5,6,7,8,9,10,11,12],e=[13,14,15,16,17,18,19,20,21,22],s=[...t,...e],o=[];for(let r of s){let i=yield this.getTutorialsByRoadmapStep(r);o.push({stepId:r,hasTutorial:i.length>0,tutorial:i.length>0?i[0]:void 0})}return o}catch(t){throw console.error("\u274C Error getting roadmap steps with tutorials:",t),t}})}testFirebaseConnection(){return n(this,null,function*(){try{console.log("\u{1F504} Testing Firebase connection...");let t=f(this.firestore,"tutorials"),e=yield y(T(t,$(1)));return console.log("\u2705 Firebase connection test successful"),!0}catch(t){console.error("\u274C Firebase connection test failed:",t);try{let e=c(f(this.firestore,"connection_test"));return yield m(e,{test:!0,timestamp:l.now()}),yield g(e),console.log("\u2705 Firebase connection test successful (fallback method)"),!0}catch(e){return console.error("\u274C Firebase connection test failed (fallback method):",e),!1}}})}static \u0275fac=function(e){return new(e||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();export{q as a};
