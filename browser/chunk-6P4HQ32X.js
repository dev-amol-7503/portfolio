import{h as S,l,m as $,o as h,p as g,q as c,r as k,s as v,u as D,v as A,w as y,x as p}from"./chunk-WCZYFZVM.js";import{a as T,b as m,c as b,ca as w,f as a,ia as f}from"./chunk-CNOAV3VS.js";var B=(()=>{class d{firestore=f($);toastr=f(S);constructor(){console.log("\u{1F504} MatrixNotesService initialized - Using Firebase only")}generateId(){return"tut_"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}getCurrentUserId(){return"admin"}cleanData(e){if(e==null)return null;if(Array.isArray(e))return e.map(t=>this.cleanData(t)).filter(t=>t!=null);if(typeof e=="object"&&!(e instanceof Date)&&!(e instanceof l)){let t={};for(let[s,o]of Object.entries(e)){let r=this.cleanData(o);r!=null&&(t[s]=r)}return Object.keys(t).length>0?t:null}return e}convertToDate(e){return e instanceof l?e.toDate():e instanceof Date?e:typeof e=="string"?new Date(e):new Date}testFirebaseConnection(){return a(this,null,function*(){try{let e=c(h(this.firestore,"test_connection"),"test_doc");return yield y(e,{test:!0,message:"Testing Firebase connection",timestamp:l.now()}),yield g(e),console.log("\u2705 Firebase connection test successful"),!0}catch(e){return console.error("\u274C Firebase connection test failed:",e),!1}})}getAllTutorials(){return a(this,null,function*(){try{console.log("\u{1F504} Fetching all tutorials from Firebase...");let e=h(this.firestore,"tutorials"),t=A(e,D("createdAt","desc")),s=yield v(t),o=[];return s.forEach(r=>{try{let i=r.data(),u=this.firestoreToTutorial(r.id,i);i.roadmapStep!==void 0&&(u.roadmapStep=Number(i.roadmapStep)),o.push(u)}catch(i){console.error(`\u274C Error processing tutorial ${r.id}:`,i)}}),console.log(`\u2705 Fetched ${o.length} tutorials from Firebase`),o}catch(e){throw console.error("\u274C Error fetching tutorials:",e),e}})}getPublishedTutorials(){return a(this,null,function*(){try{let t=(yield this.getAllTutorials()).filter(s=>s.published);return console.log(`\u2705 Found ${t.length} published tutorials`),t}catch(e){throw console.error("\u274C Error fetching published tutorials:",e),e}})}getTutorial(e){return a(this,null,function*(){try{console.log(`\u{1F504} Fetching tutorial: ${e}`);let t=c(this.firestore,"tutorials",e),s=yield k(t);if(!s.exists())return console.log(`\u274C Tutorial not found: ${e}`),null;let o=this.firestoreToTutorial(s.id,s.data());return console.log(`\u2705 Tutorial fetched successfully: ${o.title}`),o}catch(t){throw console.error(`\u274C Error fetching tutorial ${e}:`,t),this.toastr.error(`Failed to fetch tutorial: ${t.message}`),t}})}updateTutorial(e,t){return a(this,null,function*(){try{console.log(`\u{1F504} Updating tutorial: ${e}`);let s=t,{id:o}=s,r=b(s,["id"]),i={updatedAt:l.fromDate(new Date)};r.title!==void 0&&(i.title=r.title),r.description!==void 0&&(i.description=r.description),r.content!==void 0&&(i.content=r.content),r.tags!==void 0&&(i.tags=r.tags),r.category!==void 0&&(i.category=r.category),r.published!==void 0&&(i.published=r.published),r.featured!==void 0&&(i.featured=r.featured),r.readingTime!==void 0&&(i.readingTime=r.readingTime),r.difficulty!==void 0&&(i.difficulty=r.difficulty),r.views!==void 0&&(i.views=r.views),r.likes!==void 0&&(i.likes=r.likes);let u=this.cleanData(i);console.log("\u{1F4DD} Updating tutorial with data:",u);let n=c(this.firestore,"tutorials",e);yield p(n,u),console.log(`\u2705 Tutorial updated successfully: ${e}`),this.toastr.success("Tutorial updated successfully")}catch(o){throw console.error(`\u274C Error updating tutorial ${e}:`,o),this.toastr.error(`Failed to update tutorial: ${o.message}`),o}})}deleteTutorial(e){return a(this,null,function*(){try{console.log(`\u{1F504} Deleting tutorial: ${e}`);let t=c(this.firestore,"tutorials",e);yield g(t),console.log(`\u2705 Tutorial deleted successfully: ${e}`),this.toastr.success("Tutorial deleted successfully")}catch(t){throw console.error(`\u274C Error deleting tutorial ${e}:`,t),this.toastr.error(`Failed to delete tutorial: ${t.message}`),t}})}publishTutorial(e){return a(this,null,function*(){try{console.log(`\u{1F504} Publishing tutorial: ${e}`);let t=c(this.firestore,"tutorials",e);yield p(t,{published:!0,publishedAt:l.fromDate(new Date),updatedAt:l.fromDate(new Date)}),console.log(`\u2705 Tutorial published successfully: ${e}`),this.toastr.success("Tutorial published successfully")}catch(t){throw console.error(`\u274C Error publishing tutorial ${e}:`,t),this.toastr.error(`Failed to publish tutorial: ${t.message}`),t}})}unpublishTutorial(e){return a(this,null,function*(){try{console.log(`\u{1F504} Unpublishing tutorial: ${e}`);let t=c(this.firestore,"tutorials",e);yield p(t,{published:!1,updatedAt:l.fromDate(new Date)}),console.log(`\u2705 Tutorial unpublished successfully: ${e}`),this.toastr.success("Tutorial unpublished successfully")}catch(t){throw console.error(`\u274C Error unpublishing tutorial ${e}:`,t),this.toastr.error(`Failed to unpublish tutorial: ${t.message}`),t}})}incrementViews(e){return a(this,null,function*(){try{let t=yield this.getTutorial(e);t&&(yield this.updateTutorial(e,{views:(t.views||0)+1}))}catch(t){console.error("Error incrementing views:",t)}})}incrementLikes(e){return a(this,null,function*(){try{let t=yield this.getTutorial(e);t&&(yield this.updateTutorial(e,{likes:(t.likes||0)+1}))}catch(t){console.error("Error incrementing likes:",t)}})}getTutorialsByRoadmapStep(e){return a(this,null,function*(){try{console.log(`\u{1F504} Fetching tutorials for step ${e}`);let s=(yield this.getAllTutorials()).filter(o=>{let r=o.roadmapStep===e,i=o.published===!0;return r&&i});return s.sort((o,r)=>o.topicOrder&&r.topicOrder?o.topicOrder-r.topicOrder:new Date(o.createdAt).getTime()-new Date(r.createdAt).getTime()),console.log(`\u2705 Found ${s.length} tutorials for step ${e}`),s}catch(t){throw console.error(`\u274C Error fetching tutorials for roadmap step ${e}:`,t),t}})}getTutorialByRoadmapStep(e){return a(this,null,function*(){try{let t=yield this.getTutorialsByRoadmapStep(e);return t.length>0?t[0]:null}catch(t){return console.error(`\u274C Error getting tutorial for roadmap step ${e}:`,t),null}})}debugRoadmapStepMappings(){return a(this,null,function*(){try{console.log("\u{1F50D} DEBUG: Checking roadmap step mappings...");let e=yield this.getAllTutorials(),t=e.filter(r=>r.published);console.log(`\u{1F4CA} Total tutorials: ${e.length}`),console.log(`\u{1F4CA} Published tutorials: ${t.length}`);let s=t.filter(r=>r.roadmapStep);console.log(`\u{1F4CD} Tutorials with roadmap steps: ${s.length}`);let o={};s.forEach(r=>{r.roadmapStep&&(o[r.roadmapStep]||(o[r.roadmapStep]=[]),o[r.roadmapStep].push(r))}),console.log("\u{1F4CB} Roadmap Step Mapping Summary:"),Object.keys(o).forEach(r=>{console.log(`  Step ${r}: ${o[parseInt(r)].length} tutorials`),o[parseInt(r)].forEach(i=>{console.log(`    - ${i.title} (ID: ${i.id})`)})})}catch(e){console.error("\u274C Debug error:",e)}})}hasTutorialForStep(e){return a(this,null,function*(){try{return(yield this.getTutorialsByRoadmapStep(e)).length>0}catch(t){return console.error(`\u274C Error checking tutorial for step ${e}:`,t),!1}})}getRoadmapStepsWithTutorials(){return a(this,null,function*(){try{let e=[1,2,3,4,5,6,7,8,9,10,11,12],t=[13,14,15,16,17,18,19,20,21,22],s=[...e,...t],o=[];for(let r of s){let i=yield this.getTutorialsByRoadmapStep(r);o.push({stepId:r,hasTutorial:i.length>0,tutorial:i.length>0?i[0]:void 0})}return o}catch(e){throw console.error("\u274C Error getting roadmap steps with tutorials:",e),e}})}createTutorialForRoadmapStep(e,t,s,o){return a(this,null,function*(){try{let r=m(T({},e),{roadmapStep:t,roadmapType:s,stepTitle:o,published:!0});return yield this.createTutorial(r)}catch(r){throw console.error(`\u274C Error creating tutorial for roadmap step ${t}:`,r),r}})}getRoadmapProgress(){return a(this,null,function*(){try{let e=yield this.getAllTutorials(),t=e.filter(o=>o.published);return{totalTutorials:e.length,publishedTutorials:t.length,totalViews:e.reduce((o,r)=>o+(r.views||0),0),totalLikes:e.reduce((o,r)=>o+(r.likes||0),0),byCategory:this.groupTutorialsByCategory(e),byDifficulty:this.groupTutorialsByDifficulty(e)}}catch(e){throw console.error("Error getting roadmap progress:",e),e}})}groupTutorialsByCategory(e){let t={};return e.forEach(s=>{t[s.category]||(t[s.category]=0),t[s.category]++}),t}groupTutorialsByDifficulty(e){let t={};return e.forEach(s=>{t[s.difficulty]||(t[s.difficulty]=0),t[s.difficulty]++}),t}getTutorialsCount(){return a(this,null,function*(){try{return(yield this.getAllTutorials()).length}catch(e){return console.error("Error getting tutorials count:",e),0}})}getDatabaseInfo(){return a(this,null,function*(){try{let e=yield this.getAllTutorials(),t=e.filter(o=>o.published),s=e.filter(o=>!o.published);return{totalTutorials:e.length,publishedTutorials:t.length,draftTutorials:s.length,totalViews:e.reduce((o,r)=>o+(r.views||0),0),totalLikes:e.reduce((o,r)=>o+(r.likes||0),0)}}catch(e){return console.error("Error getting database info:",e),null}})}firestoreToTutorial(e,t){return{id:e,title:t.title||"Untitled Tutorial",description:t.description||"",content:t.content||[],tags:t.tags||[],category:t.category||"general",author:t.author||this.getCurrentUserId(),published:t.published||!1,featured:t.featured||!1,createdAt:this.convertToDate(t.createdAt),updatedAt:this.convertToDate(t.updatedAt),readingTime:t.readingTime||5,difficulty:t.difficulty||"beginner",bookmarks:t.bookmarks||[],views:t.views||0,likes:t.likes||0,roadmapStep:t.roadmapStep||void 0,roadmapType:t.roadmapType||void 0,stepTitle:t.stepTitle||void 0,technologies:t.technologies||[],prerequisites:t.prerequisites||[],learningObjectives:t.learningObjectives||[]}}createTutorial(e){return a(this,null,function*(){try{let t=this.generateId(),s=e.roadmapStep?Number(e.roadmapStep):void 0,o={id:t,title:e.title||"Untitled Tutorial",description:e.description||"",content:e.content||[],tags:e.tags||[],category:e.category||"general",author:e.author||this.getCurrentUserId(),published:e.published||!1,featured:e.featured||!1,createdAt:new Date,updatedAt:new Date,readingTime:e.readingTime||5,difficulty:e.difficulty||"beginner",bookmarks:e.bookmarks||[],views:e.views||0,likes:e.likes||0,roadmapStep:s,roadmapType:e.roadmapType,stepTitle:e.stepTitle,technologies:e.technologies||[],prerequisites:e.prerequisites||[],learningObjectives:e.learningObjectives||[]},r={title:o.title,description:o.description,content:o.content.map(n=>({id:n.id||this.generateId(),type:n.type||"text",content:n.content||"",order:n.order||0,language:n.language||"",fileName:n.fileName||"",caption:n.caption||"",title:n.title||"",metadata:n.metadata||{},showPreview:n.showPreview||!1})),tags:o.tags,category:o.category,author:o.author,published:o.published,featured:o.featured,createdAt:l.fromDate(o.createdAt),updatedAt:l.fromDate(o.updatedAt),readingTime:o.readingTime,difficulty:o.difficulty,bookmarks:o.bookmarks,views:o.views,likes:o.likes,roadmapStep:s,roadmapType:o.roadmapType,stepTitle:o.stepTitle,technologies:o.technologies,prerequisites:o.prerequisites,learningObjectives:o.learningObjectives},i=this.cleanData(r),u=c(this.firestore,"tutorials",t);return yield y(u,i),console.log("\u2705 Tutorial creat Fed with roadmap step:",s),t}catch(t){throw console.error("\u274C Error creating tutorial:",t),t}})}static \u0275fac=function(t){return new(t||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();export{B as a};
