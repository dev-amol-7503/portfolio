import{A as y,h as j,l as n,m as A,o as D,p as g,q as S,r as i,s as d,t as b,v as L,w as p,x as h,y as C,z as f}from"./chunk-PUWDF5TS.js";import{X as E,a as c,b as l,ba as w,f as r,n as m,u as v,z as F}from"./chunk-DNIUE2Q2.js";var $=(()=>{class u{firestore=w(A);toastr=w(j);solutionsSubject=new m([]);solutions$=this.solutionsSubject.asObservable();solutionsCollection=g(this.firestore,"developer-solutions");constructor(){console.log("\u{1F504} DeveloperSolutionsService initialized"),this.initializeService()}initializeService(){return r(this,null,function*(){try{(yield this.testFirebaseConnection())?yield this.loadAllSolutions():(console.error("\u274C Cannot initialize service - No database connection"),this.toastr.error("Cannot connect to database. Please check your connection."))}catch(t){console.error("\u274C Service initialization failed:",t)}})}createSolution(t){return r(this,null,function*(){try{if(!(yield this.testFirebaseConnection()))throw new Error("No database connection");let o=i(this.solutionsCollection).id,s=l(c({},t),{id:o,createdAt:n.now(),updatedAt:n.now(),views:0,likes:0}),a=i(this.firestore,"developer-solutions",o);return yield C(a,s),this.toastr.success("Solution created successfully!"),yield this.loadAllSolutions(),o}catch(e){console.error("Error creating solution:",e);let o=e.message||"Failed to create solution";throw this.toastr.error(o),e}})}updateSolution(t,e){return r(this,null,function*(){try{if(!(yield this.testFirebaseConnection()))throw new Error("No database connection");let s=i(this.firestore,"developer-solutions",t);if(!(yield d(s)).exists())throw new Error("Solution not found");let M=l(c({},e),{updatedAt:n.now()});yield f(s,M),this.toastr.success("Solution updated successfully!"),yield this.loadAllSolutions()}catch(o){console.error("Error updating solution:",o);let s=o.message||"Failed to update solution";throw this.toastr.error(s),o}})}deleteSolution(t){return r(this,null,function*(){try{if(!(yield this.testFirebaseConnection()))throw new Error("No database connection");let o=i(this.firestore,"developer-solutions",t);if(!(yield d(o)).exists())throw new Error("Solution not found");yield S(o),this.toastr.success("Solution deleted successfully!"),yield this.loadAllSolutions()}catch(e){console.error("Error deleting solution:",e);let o=e.message||"Failed to delete solution";throw this.toastr.error(o),e}})}loadAllSolutions(){return r(this,null,function*(){try{console.log("\u{1F504} Loading all solutions...");let t=h(this.solutionsCollection,p("createdAt","desc")),e=yield b(t),o=[];e.forEach(s=>{let a=s.data();o.push(l(c({},a),{id:s.id}))}),console.log(`\u2705 Loaded ${o.length} solutions`),this.solutionsSubject.next(o)}catch(t){console.error("Error loading solutions:",t);let e=t.message||"Failed to load solutions";this.toastr.error(e)}})}getSolution(t){return r(this,null,function*(){try{if(!(yield this.testFirebaseConnection()))throw new Error("No database connection");let o=i(this.firestore,"developer-solutions",t),s=yield d(o);if(s.exists()){let a=s.data();return l(c({},a),{id:s.id})}return null}catch(e){console.error("Error getting solution:",e);let o=e.message||"Failed to load solution";throw this.toastr.error(o),e}})}getSolution$(t){let e=i(this.firestore,"developer-solutions",t);return v(d(e)).pipe(F(o=>{if(o.exists()){let s=o.data();return l(c({},s),{id:o.id})}return null}))}testFirebaseConnection(){return r(this,null,function*(){try{console.log("\u{1F504} Testing Firebase connection...");let t=h(this.solutionsCollection,L(1)),e=yield b(t);return console.log("\u2705 Firebase connection test successful - Method 1"),!0}catch(t){console.error("\u274C Firebase connection test failed - Method 1:",t);try{let e=g(this.firestore,"connection_tests"),o=i(e);return yield C(o,{test:!0,timestamp:n.now(),message:"Connection test"}),yield S(o),console.log("\u2705 Firebase connection test successful - Method 2"),!0}catch(e){return console.error("\u274C Firebase connection test failed - Method 2:",e),e.code&&(console.error("Firebase error code:",e.code),console.error("Firebase error message:",e.message)),!1}}})}getConnectionStatus(){return r(this,null,function*(){try{let t=yield this.testFirebaseConnection();return{connected:t,message:t?"Connected to database":"Disconnected from database"}}catch(t){return{connected:!1,message:`Connection error: ${t.message}`,error:t}}})}getSolutionsByCategory(t){return this.solutionsSubject.value.filter(e=>e.category.toLowerCase()===t.toLowerCase()&&e.published)}getSolutionsByCategory$(t){let e=h(this.solutionsCollection,y("category","==",t),y("published","==",!0),p("createdAt","desc"));return D(e,{idField:"id"})}getFeaturedSolutions(){return this.solutionsSubject.value.filter(t=>t.featured&&t.published).slice(0,6)}getRecentSolutions(t=6){return this.solutionsSubject.value.filter(e=>e.published).slice(0,t)}getSolutionsCount(){let t=this.solutionsSubject.value;return{total:t.length,published:t.filter(e=>e.published).length,draft:t.filter(e=>!e.published).length,featured:t.filter(e=>e.featured).length}}searchSolutions(t){let e=t.toLowerCase();return this.solutionsSubject.value.filter(o=>o.title.toLowerCase().includes(e)||o.description.toLowerCase().includes(e)||o.tags.some(s=>s.toLowerCase().includes(e))||o.category.toLowerCase().includes(e))}getPublishedSolutions(){return this.solutionsSubject.value.filter(t=>t.published)}getDraftSolutions(){return this.solutionsSubject.value.filter(t=>!t.published)}incrementViews(t){return r(this,null,function*(){try{let e=yield this.getSolution(t);if(e){let o=i(this.firestore,"developer-solutions",t);yield f(o,{views:(e.views||0)+1,updatedAt:n.now()}),yield this.loadAllSolutions()}}catch(e){console.error("Error incrementing views:",e)}})}toggleLike(t){return r(this,null,function*(){try{let e=yield this.getSolution(t);if(e){let o=i(this.firestore,"developer-solutions",t);yield f(o,{likes:(e.likes||0)+1,updatedAt:n.now()}),yield this.loadAllSolutions()}}catch(e){console.error("Error toggling like:",e)}})}static \u0275fac=function(e){return new(e||u)};static \u0275prov=E({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})();export{$ as a};
