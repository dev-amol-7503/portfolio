import{e as sl}from"./chunk-PTU5H6RA.js";import{Ab as Xn,Bb as be,Ga as Zu,Jb as Ye,Lb as Ct,Qb as js,Sa as el,Ta as Us,X as Xu,Ya as oe,Yb as rl,Za as Rt,Zb as il,_ as Qt,a as Te,ab as tl,b as ut,ba as Jt,cc as ei,da as ht,ea as Yt,eb as He,f as b,fa as dt,i as Ns,ja as Ls,l as lt,lc as zs,mb as Hn,n as Ju,na as Xt,nb as Qn,o as Yu,ob as we,pb as Jn,q as Os,r as xs,rb as Qe,s as Vs,sb as Ne,ta as Ms,tb as Je,tc as Gs,ua as Fs,ub as Yn,vb as Bs,wb as qs,xb as $s,za as ft,zb as nl}from"./chunk-FYKOZL6K.js";var Pt=function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(Pt||{}),Ly="*";function cl(n,e){return{type:Pt.Trigger,name:n,definitions:e,options:{}}}function Ks(n,e=null){return{type:Pt.Animate,styles:e,timings:n}}function My(n,e=null){return{type:Pt.Sequence,steps:n,options:e}}function ti(n){return{type:Pt.Style,styles:n,offset:null}}function ni(n,e,t){return{type:Pt.State,name:n,styles:e,options:t}}function Ws(n,e,t=null){return{type:Pt.Transition,expr:n,animation:e,options:t}}var ol=class{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}},al=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,r=0,i=0,o=this.players.length;o==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(a=>{a.onDone(()=>{++t==o&&this._onFinish()}),a.onDestroy(()=>{++r==o&&this._onDestroy()}),a.onStart(()=>{++i==o&&this._onStart()})}),this.totalTime=this.players.reduce((a,l)=>Math.max(a,l.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(r=>{let i=r.totalTime?Math.min(1,t/r.totalTime):1;r.setPosition(i)})}getPosition(){let e=this.players.reduce((t,r)=>t===null||r.totalTime>t.totalTime?r:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(r=>r()),t.length=0}},Fy="!";var ul=["toast-component",""];function Af(n,e){if(n&1){let t=$s();Ne(0,"button",5),Xn("click",function(){Ms(t);let i=be();return Fs(i.remove())}),Ne(1,"span",6),Ye(2,"\xD7"),Je()()}}function bf(n,e){if(n&1&&(Bs(0),Ye(1),qs()),n&2){let t=be(2);oe(),Ct("[",t.duplicatesCount+1,"]")}}function Sf(n,e){if(n&1&&(Ne(0,"div"),Ye(1),Hn(2,bf,2,1,"ng-container",4),Je()),n&2){let t=be();Qe(t.options.titleClass),Qn("aria-label",t.title),oe(),Ct(" ",t.title," "),oe(),we("ngIf",t.duplicatesCount)}}function Rf(n,e){if(n&1&&Yn(0,"div",7),n&2){let t=be();Qe(t.options.messageClass),we("innerHTML",t.message,Us)}}function Cf(n,e){if(n&1&&(Ne(0,"div",8),Ye(1),Je()),n&2){let t=be();Qe(t.options.messageClass),Qn("aria-label",t.message),oe(),Ct(" ",t.message," ")}}function Pf(n,e){if(n&1&&(Ne(0,"div"),Yn(1,"div",9),Je()),n&2){let t=be();oe(),Jn("width",t.width+"%")}}function Df(n,e){if(n&1){let t=$s();Ne(0,"button",5),Xn("click",function(){Ms(t);let i=be();return Fs(i.remove())}),Ne(1,"span",6),Ye(2,"\xD7"),Je()()}}function kf(n,e){if(n&1&&(Bs(0),Ye(1),qs()),n&2){let t=be(2);oe(),Ct("[",t.duplicatesCount+1,"]")}}function Nf(n,e){if(n&1&&(Ne(0,"div"),Ye(1),Hn(2,kf,2,1,"ng-container",4),Je()),n&2){let t=be();Qe(t.options.titleClass),Qn("aria-label",t.title),oe(),Ct(" ",t.title," "),oe(),we("ngIf",t.duplicatesCount)}}function Of(n,e){if(n&1&&Yn(0,"div",7),n&2){let t=be();Qe(t.options.messageClass),we("innerHTML",t.message,Us)}}function xf(n,e){if(n&1&&(Ne(0,"div",8),Ye(1),Je()),n&2){let t=be();Qe(t.options.messageClass),Qn("aria-label",t.message),oe(),Ct(" ",t.message," ")}}function Vf(n,e){if(n&1&&(Ne(0,"div"),Yn(1,"div",9),Je()),n&2){let t=be();oe(),Jn("width",t.width+"%")}}var Hs=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},Qs=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},Js=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new lt;_activate=new lt;_manualClose=new lt;_resetTimeout=new lt;_countDuplicate=new lt;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},Zt=class{toastId;config;message;title;toastType;toastRef;_onTap=new lt;_onAction=new lt;constructor(e,t,r,i,o,a){this.toastId=e,this.config=t,this.message=r,this.title=i,this.toastType=o,this.toastRef=a,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},ll={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},hl=new Jt("ToastConfig"),Ys=class extends Qs{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,r){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=r}attachComponentPortal(e,t){let r=this._componentFactoryResolver.resolveComponentFactory(e.component),i;return i=r.create(e.injector),this._appRef.attachView(i.hostView),this.setDisposeFn(()=>{this._appRef.detachView(i.hostView),i.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(i),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(i)),i}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},Lf=(()=>{class n{_document=Yt(zs);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Xs=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},Mf=(()=>{class n{_overlayContainer=Yt(Lf);_componentFactoryResolver=Yt(tl);_appRef=Yt(ei);_document=Yt(zs);_paneElements=new Map;create(t,r){return this._createOverlayRef(this.getPaneElement(t,r))}getPaneElement(t="",r){return this._paneElements.get(r)||this._paneElements.set(r,{}),this._paneElements.get(r)[t]||(this._paneElements.get(r)[t]=this._createPaneElement(t,r)),this._paneElements.get(r)[t]}_createPaneElement(t,r){let i=this._document.createElement("div");return i.id="toast-container",i.classList.add(t),i.classList.add("toast-container"),r?r.getContainerElement().appendChild(i):this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalHost(t){return new Ys(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new Xs(this._createPortalHost(t))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),dl=(()=>{class n{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,r,i,o,a){this.overlay=r,this._injector=i,this.sanitizer=o,this.ngZone=a,this.toastrConfig=Te(Te({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=Te(Te({},t.default.iconClasses),t.config.iconClasses))}show(t,r,i={},o=""){return this._preBuildNotification(o,t,r,this.applyConfig(i))}success(t,r,i={}){let o=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(o,t,r,this.applyConfig(i))}error(t,r,i={}){let o=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(o,t,r,this.applyConfig(i))}info(t,r,i={}){let o=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(o,t,r,this.applyConfig(i))}warning(t,r,i={}){let o=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(o,t,r,this.applyConfig(i))}clear(t){for(let r of this.toasts)if(t!==void 0){if(r.toastId===t){r.toastRef.manualClose();return}}else r.toastRef.manualClose()}remove(t){let r=this._findToast(t);if(!r||(r.activeToast.toastRef.close(),this.toasts.splice(r.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let i=this.toasts[this.currentlyActive].toastRef;i.isInactive()||(this.currentlyActive=this.currentlyActive+1,i.activate())}return!0}findDuplicate(t="",r="",i,o){let{includeTitleDuplicates:a}=this.toastrConfig;for(let l of this.toasts){let h=a&&l.title===t;if((!a||h)&&l.message===r)return l.toastRef.onDuplicate(i,o),l}return null}applyConfig(t={}){return Te(Te({},this.toastrConfig),t)}_findToast(t){for(let r=0;r<this.toasts.length;r++)if(this.toasts[r].toastId===t)return{index:r,activeToast:this.toasts[r]};return null}_preBuildNotification(t,r,i,o){return o.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,r,i,o)):this._buildNotification(t,r,i,o)}_buildNotification(t,r,i,o){if(!o.toastComponent)throw new Error("toastComponent required");let a=this.findDuplicate(i,r,this.toastrConfig.resetTimeoutOnDuplicate&&o.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&i||r)&&this.toastrConfig.preventDuplicates&&a!==null)return a;this.previousToastMessage=r;let l=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(l=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let h=this.overlay.create(o.positionClass,this.overlayContainer);this.index=this.index+1;let f=r;r&&o.enableHtml&&(f=this.sanitizer.sanitize(el.HTML,r));let m=new Js(h),T=new Zt(this.index,o,f,i,t,m),S=[{provide:Zt,useValue:T}],R=ft.create({providers:S,parent:this._injector}),N=new Hs(o.toastComponent,R),x=h.attach(N,o.newestOnTop);m.componentInstance=x.instance;let k={toastId:this.index,title:i||"",message:r||"",toastRef:m,onShown:m.afterActivate(),onHidden:m.afterClosed(),onTap:T.onTap(),onAction:T.onAction(),portal:x};return l||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{k.toastRef.activate()})),this.toasts.push(k),k}static \u0275fac=function(r){return new(r||n)(ht(hl),ht(Mf),ht(ft),ht(sl),ht(He))};static \u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ff=(()=>{class n{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=-1;toastClasses="";state;get displayStyle(){if(this.state.value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,r,i){this.toastrService=t,this.toastPackage=r,this.ngZone=i,this.message=r.message,this.title=r.title,this.options=r.config,this.originalTimeout=r.config.timeOut,this.toastClasses=`${r.toastType} ${r.config.toastClass}`,this.sub=r.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=r.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=r.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=r.toastRef.countDuplicate().subscribe(o=>{this.duplicatesCount=o}),this.state={value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}}}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state=ut(Te({},this.state),{value:"active"}),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width===0||this.width===100||!this.options.timeOut)return;let t=new Date().getTime(),r=this.hideTime-t;this.width=r/this.options.timeOut*100,this.options.progressAnimation==="increasing"&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state=ut(Te({},this.state),{value:"active"}),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state.value!=="removed"&&(clearTimeout(this.timeout),this.state=ut(Te({},this.state),{value:"removed"}),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state.value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state.value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state.value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,r){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),r)):this.timeout=setTimeout(()=>t(),r)}outsideInterval(t,r){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),r)):this.intervalId=setInterval(()=>t(),r)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(r){return new(r||n)(Rt(dl),Rt(Zt),Rt(He))};static \u0275cmp=Ls({type:n,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(r,i){r&1&&Xn("click",function(){return i.tapToast()})("mouseenter",function(){return i.stickAround()})("mouseleave",function(){return i.delayedHideToast()}),r&2&&(nl("@flyInOut",i.state),Qe(i.toastClasses),Jn("display",i.displayStyle))},standalone:!0,features:[js],attrs:ul,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(r,i){r&1&&Hn(0,Af,3,0,"button",0)(1,Sf,3,5,"div",1)(2,Rf,1,3,"div",2)(3,Cf,2,4,"div",3)(4,Pf,2,2,"div",4),r&2&&(we("ngIf",i.options.closeButton),oe(),we("ngIf",i.title),oe(),we("ngIf",i.message&&i.options.enableHtml),oe(),we("ngIf",i.message&&!i.options.enableHtml),oe(),we("ngIf",i.options.progressBar))},dependencies:[Gs],encapsulation:2,data:{animation:[cl("flyInOut",[ni("inactive",ti({opacity:0})),ni("active",ti({opacity:1})),ni("removed",ti({opacity:0})),Ws("inactive => active",Ks("{{ easeTime }}ms {{ easing }}")),Ws("active => removed",Ks("{{ easeTime }}ms {{ easing }}"))])]}})}return n})(),Uf=ut(Te({},ll),{toastComponent:Ff}),nv=(n={})=>Xt([{provide:hl,useValue:{default:Uf,config:n}}]);var Bf=(()=>{class n{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=-1;toastClasses="";get displayStyle(){if(this.state==="inactive")return"none"}state="inactive";timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,r,i){this.toastrService=t,this.toastPackage=r,this.appRef=i,this.message=r.message,this.title=r.title,this.options=r.config,this.originalTimeout=r.config.timeOut,this.toastClasses=`${r.toastType} ${r.config.toastClass}`,this.sub=r.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=r.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=r.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=r.toastRef.countDuplicate().subscribe(o=>{this.duplicatesCount=o})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state="active",!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width===0||this.width===100||!this.options.timeOut)return;let t=new Date().getTime(),r=this.hideTime-t;this.width=r/this.options.timeOut*100,this.options.progressAnimation==="increasing"&&(this.width=100-this.width),this.width<=0&&(this.width=0),this.width>=100&&(this.width=100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state="active",this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width=-1,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state!=="removed"&&(clearTimeout(this.timeout),this.state="removed",this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width=0)}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width=-1,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(r){return new(r||n)(Rt(dl),Rt(Zt),Rt(ei))};static \u0275cmp=Ls({type:n,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(r,i){r&1&&Xn("click",function(){return i.tapToast()})("mouseenter",function(){return i.stickAround()})("mouseleave",function(){return i.delayedHideToast()}),r&2&&(Qe(i.toastClasses),Jn("display",i.displayStyle))},standalone:!0,features:[js],attrs:ul,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(r,i){r&1&&Hn(0,Df,3,0,"button",0)(1,Nf,3,5,"div",1)(2,Of,1,3,"div",2)(3,xf,2,4,"div",3)(4,Vf,2,2,"div",4),r&2&&(we("ngIf",i.options.closeButton),oe(),we("ngIf",i.title),oe(),we("ngIf",i.message&&i.options.enableHtml),oe(),we("ngIf",i.message&&!i.options.enableHtml),oe(),we("ngIf",i.options.progressBar))},dependencies:[Gs],encapsulation:2})}return n})(),rv=ut(Te({},ll),{toastComponent:Bf});var pl=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},qf=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],l=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},ml={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,l=a?n[i+1]:0,h=i+2<n.length,f=h?n[i+2]:0,m=o>>2,T=(o&3)<<4|l>>4,S=(l&15)<<2|f>>6,R=f&63;h||(R=64,a||(S=64)),r.push(t[m],t[T],t[S],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(pl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;let f=i<n.length?t[n.charAt(i)]:64;++i;let T=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||l==null||f==null||T==null)throw new eo;let S=o<<2|l>>4;if(r.push(S),f!==64){let R=l<<4&240|f>>2;if(r.push(R),T!==64){let N=f<<6&192|T;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},eo=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},$f=function(n){let e=pl(n);return ml.encodeByteArray(e,!0)},Zn=function(n){return $f(n).replace(/\./g,"")},no=function(n){try{return ml.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function jf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var zf=()=>jf().__FIREBASE_DEFAULTS__,Gf=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Kf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&no(n[1]);return e&&JSON.parse(e)},ii=()=>{try{return zf()||Gf()||Kf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},gl=n=>{var e,t;return(t=(e=ii())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},_l=n=>{let e=gl(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ro=()=>{var n;return(n=ii())===null||n===void 0?void 0:n.config},yl=n=>{var e;return(e=ii())===null||e===void 0?void 0:e[`_${n}`]};var ri=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function vl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Zn(JSON.stringify(t)),Zn(JSON.stringify(a)),""].join(".")}function Se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Il(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Se())}function Wf(){var n;let e=(n=ii())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wl(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function El(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Tl(){return!Wf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function io(){try{return typeof indexedDB=="object"}catch{return!1}}function Al(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}var Hf="FirebaseError",Ce=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Hf,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xe.prototype.create)}},Xe=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?Qf(o,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Ce(i,l,r)}};function Qf(n,e){return n.replace(Jf,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Jf=/\{\$([^}]+)}/g;function en(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(fl(o)&&fl(a)){if(!en(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function fl(n){return n!==null&&typeof n=="object"}function so(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function bl(n,e){let t=new to(n,e);return t.subscribe.bind(t)}var to=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Yf(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Zs),i.error===void 0&&(i.error=Zs),i.complete===void 0&&(i.complete=Zs);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Yf(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Zs(){}var ov=4*60*60*1e3;function Ve(n){return n&&n._delegate?n._delegate:n}var Pe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Dt="[DEFAULT]";var oo=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new ri;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Zf(e))try{this.getOrInitializeService({instanceIdentifier:Dt})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Dt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return b(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Dt){return this.instances.has(e)}getOptions(e=Dt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Xf(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Dt){return this.component?this.component.multipleInstances?e:Dt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Xf(n){return n===Dt?void 0:n}function Zf(n){return n.instantiationMode==="EAGER"}var si=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new oo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var ep=[],B=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(B||{}),tp={debug:B.DEBUG,verbose:B.VERBOSE,info:B.INFO,warn:B.WARN,error:B.ERROR,silent:B.SILENT},np=B.INFO,rp={[B.DEBUG]:"log",[B.VERBOSE]:"log",[B.INFO]:"info",[B.WARN]:"warn",[B.ERROR]:"error"},ip=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=rp[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},pt=class{constructor(e){this.name=e,this._logLevel=np,this._logHandler=ip,this._userLogHandler=null,ep.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in B))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,B.DEBUG,...e),this._logHandler(this,B.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,B.VERBOSE,...e),this._logHandler(this,B.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,B.INFO,...e),this._logHandler(this,B.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,B.WARN,...e),this._logHandler(this,B.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,B.ERROR,...e),this._logHandler(this,B.ERROR,...e)}};var sp=(n,e)=>e.some(t=>n instanceof t),Sl,Rl;function op(){return Sl||(Sl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ap(){return Rl||(Rl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Cl=new WeakMap,co=new WeakMap,Pl=new WeakMap,ao=new WeakMap,lo=new WeakMap;function cp(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Le(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Cl.set(t,n)}).catch(()=>{}),lo.set(e,n),e}function up(n){if(co.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});co.set(n,e)}var uo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return co.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Pl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Le(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Dl(n){uo=n(uo)}function lp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(oi(this),e,...t);return Pl.set(r,e.sort?e.sort():[e]),Le(r)}:ap().includes(n)?function(...e){return n.apply(oi(this),e),Le(Cl.get(this))}:function(...e){return Le(n.apply(oi(this),e))}}function hp(n){return typeof n=="function"?lp(n):(n instanceof IDBTransaction&&up(n),sp(n,op())?new Proxy(n,uo):n)}function Le(n){if(n instanceof IDBRequest)return cp(n);if(ao.has(n))return ao.get(n);let e=hp(n);return e!==n&&(ao.set(n,e),lo.set(e,n)),e}var oi=n=>lo.get(n);function Nl(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),l=Le(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Le(a.result),h.oldVersion,h.newVersion,Le(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}var dp=["get","getKey","getAll","getAllKeys","count"],fp=["put","add","delete","clear"],ho=new Map;function kl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ho.get(e))return ho.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=fp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||dp.includes(t)))return;let o=function(a,...l){return b(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),f=h.store;return r&&(f=f.index(l.shift())),(yield Promise.all([f[t](...l),i&&h.done]))[0]})};return ho.set(e,o),o}Dl(n=>ut(Te({},n),{get:(e,t,r)=>kl(e,t)||n.get(e,t,r),has:(e,t)=>!!kl(e,t)||n.has(e,t)}));var po=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pp(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function pp(n){let e=n.getComponent();return e?.type==="VERSION"}var mo="@firebase/app",Ol="0.10.3";var kt=new pt("@firebase/app"),mp="@firebase/app-compat",gp="@firebase/analytics-compat",_p="@firebase/analytics",yp="@firebase/app-check-compat",vp="@firebase/app-check",Ip="@firebase/auth",wp="@firebase/auth-compat",Ep="@firebase/database",Tp="@firebase/database-compat",Ap="@firebase/functions",bp="@firebase/functions-compat",Sp="@firebase/installations",Rp="@firebase/installations-compat",Cp="@firebase/messaging",Pp="@firebase/messaging-compat",Dp="@firebase/performance",kp="@firebase/performance-compat",Np="@firebase/remote-config",Op="@firebase/remote-config-compat",xp="@firebase/storage",Vp="@firebase/storage-compat",Lp="@firebase/firestore",Mp="@firebase/vertexai-preview",Fp="@firebase/firestore-compat",Up="firebase",Bp="10.12.0";var go="[DEFAULT]",qp={[mo]:"fire-core",[mp]:"fire-core-compat",[_p]:"fire-analytics",[gp]:"fire-analytics-compat",[vp]:"fire-app-check",[yp]:"fire-app-check-compat",[Ip]:"fire-auth",[wp]:"fire-auth-compat",[Ep]:"fire-rtdb",[Tp]:"fire-rtdb-compat",[Ap]:"fire-fn",[bp]:"fire-fn-compat",[Sp]:"fire-iid",[Rp]:"fire-iid-compat",[Cp]:"fire-fcm",[Pp]:"fire-fcm-compat",[Dp]:"fire-perf",[kp]:"fire-perf-compat",[Np]:"fire-rc",[Op]:"fire-rc-compat",[xp]:"fire-gcs",[Vp]:"fire-gcs-compat",[Lp]:"fire-fst",[Fp]:"fire-fst-compat",[Mp]:"fire-vertex","fire-js":"fire-js",[Up]:"fire-js-all"};var er=new Map,$p=new Map,_o=new Map;function xl(n,e){try{n.container.addComponent(e)}catch(t){kt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function gt(n){let e=n.name;if(_o.has(e))return kt.debug(`There were multiple attempts to register component ${e}.`),!1;_o.set(e,n);for(let t of er.values())xl(t,n);for(let t of $p.values())xl(t,n);return!0}function wo(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function tn(n){return n.settings!==void 0}var jp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mt=new Xe("app","Firebase",jp);var yo=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Pe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mt.create("app-deleted",{appName:this._name})}};var nn=Bp;function Eo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:go,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw mt.create("bad-app-name",{appName:String(i)});if(t||(t=ro()),!t)throw mt.create("no-options");let o=er.get(i);if(o){if(en(t,o.options)&&en(r,o.config))return o;throw mt.create("duplicate-app",{appName:i})}let a=new si(i);for(let h of _o.values())a.addComponent(h);let l=new yo(t,r,a);return er.set(i,l),l}function nr(n=go){let e=er.get(n);if(!e&&n===go&&ro())return Eo();if(!e)throw mt.create("no-app",{appName:n});return e}function ai(){return Array.from(er.values())}function ce(n,e,t){var r;let i=(r=qp[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){let l=[`Unable to register library "${i}" with version "${e}":`];o&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),kt.warn(l.join(" "));return}gt(new Pe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var zp="firebase-heartbeat-database",Gp=1,tr="firebase-heartbeat-store",fo=null;function Fl(){return fo||(fo=Nl(zp,Gp,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(tr)}catch(t){console.warn(t)}}}}).catch(n=>{throw mt.create("idb-open",{originalErrorMessage:n.message})})),fo}function Kp(n){return b(this,null,function*(){try{let t=(yield Fl()).transaction(tr),r=yield t.objectStore(tr).get(Ul(n));return yield t.done,r}catch(e){if(e instanceof Ce)kt.warn(e.message);else{let t=mt.create("idb-get",{originalErrorMessage:e?.message});kt.warn(t.message)}}})}function Vl(n,e){return b(this,null,function*(){try{let r=(yield Fl()).transaction(tr,"readwrite");yield r.objectStore(tr).put(e,Ul(n)),yield r.done}catch(t){if(t instanceof Ce)kt.warn(t.message);else{let r=mt.create("idb-set",{originalErrorMessage:t?.message});kt.warn(r.message)}}})}function Ul(n){return`${n.name}!${n.options.appId}`}var Wp=1024,Hp=30*24*60*60*1e3,vo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Io(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return b(this,null,function*(){var e,t;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ll();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o)))return this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{let l=new Date(a.date).valueOf();return Date.now()-l<=Hp}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return b(this,null,function*(){var e;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Ll(),{heartbeatsToSend:r,unsentEntries:i}=Qp(this._heartbeatsCache.heartbeats),o=Zn(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o})}};function Ll(){return new Date().toISOString().substring(0,10)}function Qp(n,e=Wp){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Ml(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Ml(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Io=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return b(this,null,function*(){return io()?Al().then(()=>!0).catch(()=>!1):!1})}read(){return b(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Kp(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return b(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Vl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return b(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Vl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Ml(n){return Zn(JSON.stringify({version:2,heartbeats:n})).length}function Jp(n){gt(new Pe("platform-logger",e=>new po(e),"PRIVATE")),gt(new Pe("heartbeat",e=>new vo(e),"PRIVATE")),ce(mo,Ol,n),ce(mo,Ol,"esm2017"),ce("fire-js","")}Jp("");var Yp="firebase",Xp="10.12.0";ce(Yp,Xp,"app");var sn=new rl("ANGULARFIRE2_VERSION");function Ao(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var ir=(n,e)=>{let t=e?[e]:ai(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},rr=class{constructor(){return ir(Zp)}},Zp="app-check";function rn(){}var ci=class{zone;delegate;constructor(e,t=Yu){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(o,t,r)}},To=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",rn,{},rn,rn)),t.pipe(Xu({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},sr=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new ci(Zone.current)),this.insideAngular=t.run(()=>new ci(Zone.current,Ju)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ht(He))};static \u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ui(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function em(n){return ui().ngZone.runOutsideAngular(()=>n())}function Nt(n){return ui().ngZone.run(()=>n())}function tm(n){return nm(ui())(n)}function nm(n){return function(t){return t=t.lift(new To(n.ngZone)),t.pipe(Vs(n.outsideAngular),xs(n.insideAngular))}}var rm=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Nt(()=>n.apply(void 0,r))},Ze=(n,e)=>function(){let t,r=arguments;for(let o=0;o<arguments.length;o++)typeof r[o]=="function"&&(e&&(t||=Nt(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",rn,{},rn,rn))),r[o]=rm(r[o],t));let i=em(()=>n.apply(this,r));if(!e)if(i instanceof Ns){let o=ui();return i.pipe(Vs(o.outsideAngular),xs(o.insideAngular))}else return Nt(()=>i);return i instanceof Ns?i.pipe(tm):i instanceof Promise?Nt(()=>new Promise((o,a)=>i.then(l=>Nt(()=>o(l)),l=>Nt(()=>a(l))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Nt(()=>i)};var Ot=class{constructor(e){return e}},or=class{constructor(){return ai()}};function im(n){return n&&n.length===1?n[0]:new Ot(nr())}var bo=new Jt("angularfire2._apps"),sm={provide:Ot,useFactory:im,deps:[[new dt,bo]]},om={provide:or,deps:[[new dt,bo]]};function am(n){return(e,t)=>{let r=t.get(Zu);ce("angularfire",sn.full,"core"),ce("angularfire",sn.full,"app"),ce("angular",il.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Ot(i)}}function Gv(n,...e){return Xt([sm,om,{provide:bo,useFactory:am(n),multi:!0,deps:[He,ft,sr,...e]}])}var Kv=Ze(Eo,!0);function Wl(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Hl=Wl,Ql=new Xe("auth","Firebase",Wl());var fi=new pt("@firebase/auth");function um(n,...e){fi.logLevel<=B.WARN&&fi.warn(`Auth (${nn}): ${n}`,...e)}function hi(n,...e){fi.logLevel<=B.ERROR&&fi.error(`Auth (${nn}): ${n}`,...e)}function Bl(n,...e){throw Mo(n,...e)}function Lo(n,...e){return Mo(n,...e)}function Jl(n,e,t){let r=Object.assign(Object.assign({},Hl()),{[e]:t});return new Xe("auth","Firebase",r).create(e,{appName:n.name})}function di(n){return Jl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Mo(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Ql.create(n,...e)}function W(n,e,...t){if(!n)throw Mo(e,...t)}function ar(n){let e="INTERNAL ASSERTION FAILED: "+n;throw hi(e),new Error(e)}function pi(n,e){n||ar(e)}function lm(){return ql()==="http:"||ql()==="https:"}function ql(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function hm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lm()||wl()||"connection"in navigator)?navigator.onLine:!0}function dm(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Vt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,pi(t>e,"Short delay should be less than long delay!"),this.isMobile=Il()||El()}get(){return hm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function fm(n,e){pi(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var mi=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ar("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ar("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ar("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var pm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var mm=new Vt(3e4,6e4);function Yl(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function vi(o,a,l,h){return b(this,arguments,function*(n,e,t,r,i={}){return Xl(n,i,()=>b(this,null,function*(){let f={},m={};r&&(e==="GET"?m=r:f={body:JSON.stringify(r)});let T=so(Object.assign({key:n.config.apiKey},m)).slice(1),S=yield n._getAdditionalHeaders();return S["Content-Type"]="application/json",n.languageCode&&(S["X-Firebase-Locale"]=n.languageCode),mi.fetch()(Zl(n,n.config.apiHost,t,T),Object.assign({method:e,headers:S,referrerPolicy:"no-referrer"},f))}))})}function Xl(n,e,t){return b(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},pm),e);try{let i=new Co(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw li(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let l=o.ok?a.errorMessage:a.error.message,[h,f]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw li(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw li(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw li(n,"user-disabled",a);let m=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw Jl(n,m,f);Bl(n,m)}}catch(i){if(i instanceof Ce)throw i;Bl(n,"network-request-failed",{message:String(i)})}})}function Zl(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?fm(n.config,i):`${n.config.apiScheme}://${i}`}var Co=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Lo(this.auth,"network-request-failed")),mm.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function li(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Lo(n,e,r);return i.customData._tokenResponse=t,i}function gm(n,e){return b(this,null,function*(){return vi(n,"POST","/v1/accounts:delete",e)})}function eh(n,e){return b(this,null,function*(){return vi(n,"POST","/v1/accounts:lookup",e)})}function cr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Fo(n,e=!1){return b(this,null,function*(){let t=Ve(n),r=yield t.getIdToken(e),i=th(r);W(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:cr(So(i.auth_time)),issuedAtTime:cr(So(i.iat)),expirationTime:cr(So(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function So(n){return Number(n)*1e3}function th(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return hi("JWT malformed, contained fewer than 3 sections"),null;try{let i=no(t);return i?JSON.parse(i):(hi("Failed to decode base64 JWT payload"),null)}catch(i){return hi("Caught error parsing JWT payload as JSON",i?.toString()),null}}function $l(n){let e=th(n);return W(e,"internal-error"),W(typeof e.exp<"u","internal-error"),W(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Po(n,e,t=!1){return b(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Ce&&_m(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function _m({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Do=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>b(this,null,function*(){yield this.iteration()}),t)}iteration(){return b(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var lr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=cr(this.lastLoginAt),this.creationTime=cr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function gi(n){return b(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Po(n,eh(t,{idToken:r}));W(i?.users.length,t,"internal-error");let o=i.users[0];n._notifyReloadListener(o);let a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?nh(o.providerUserInfo):[],l=ym(n.providerData,a),h=n.isAnonymous,f=!(n.email&&o.passwordHash)&&!l?.length,m=h?f:!1,T={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new lr(o.createdAt,o.lastLoginAt),isAnonymous:m};Object.assign(n,T)})}function Uo(n){return b(this,null,function*(){let e=Ve(n);yield gi(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function ym(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function nh(n){return n.map(e=>{var{providerId:t}=e,r=Os(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function vm(n,e){return b(this,null,function*(){let t=yield Xl(n,{},()=>b(this,null,function*(){let r=so({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=Zl(n,i,"/v1/token",`key=${o}`),l=yield n._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",mi.fetch()(a,{method:"POST",headers:l,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Im(n,e){return b(this,null,function*(){return vi(n,"POST","/v2/accounts:revokeToken",Yl(n,e))})}var ur=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){W(e.idToken,"internal-error"),W(typeof e.idToken<"u","internal-error"),W(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):$l(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){W(e.length!==0,"internal-error");let t=$l(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return b(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(W(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return b(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield vm(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(W(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(W(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(W(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return ar("not implemented")}};function _t(n,e){W(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var hr=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=Os(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Do(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new lr(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(e){return b(this,null,function*(){let t=yield Po(this,this.stsTokenManager.getToken(this.auth,e));return W(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Fo(this,e)}reload(){return Uo(this)}_assign(e){this!==e&&(W(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){W(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return b(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield gi(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return b(this,null,function*(){if(tn(this.auth.app))return Promise.reject(di(this.auth));let e=yield this.getIdToken();return yield Po(this,gm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,l,h,f,m;let T=(r=t.displayName)!==null&&r!==void 0?r:void 0,S=(i=t.email)!==null&&i!==void 0?i:void 0,R=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,N=(a=t.photoURL)!==null&&a!==void 0?a:void 0,x=(l=t.tenantId)!==null&&l!==void 0?l:void 0,k=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,$=(f=t.createdAt)!==null&&f!==void 0?f:void 0,j=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:z,emailVerified:X,isAnonymous:ye,providerData:Q,stsTokenManager:v}=t;W(z&&v,e,"internal-error");let p=ur.fromJSON(this.name,v);W(typeof z=="string",e,"internal-error"),_t(T,e.name),_t(S,e.name),W(typeof X=="boolean",e,"internal-error"),W(typeof ye=="boolean",e,"internal-error"),_t(R,e.name),_t(N,e.name),_t(x,e.name),_t(k,e.name),_t($,e.name),_t(j,e.name);let _=new n({uid:z,auth:e,email:S,emailVerified:X,displayName:T,isAnonymous:ye,photoURL:N,phoneNumber:R,tenantId:x,stsTokenManager:p,createdAt:$,lastLoginAt:j});return Q&&Array.isArray(Q)&&(_.providerData=Q.map(y=>Object.assign({},y))),k&&(_._redirectEventId=k),_}static _fromIdTokenResponse(e,t,r=!1){return b(this,null,function*(){let i=new ur;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield gi(o),o})}static _fromGetAccountInfoResponse(e,t,r){return b(this,null,function*(){let i=t.users[0];W(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?nh(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,l=new ur;l.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new lr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h})}};var jl=new Map;function xt(n){pi(n instanceof Function,"Expected a class definition");let e=jl.get(n);return e?(pi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,jl.set(n,e),e)}var wm=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return b(this,null,function*(){return!0})}_set(t,r){return b(this,null,function*(){this.storage[t]=r})}_get(t){return b(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return b(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),ko=wm;function Ro(n,e,t){return`firebase:${n}:${e}:${t}`}var _i=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=Ro(this.userKey,i.apiKey,o),this.fullPersistenceKey=Ro("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return b(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?hr._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return b(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return b(this,null,function*(){if(!t.length)return new n(xt(ko),e,r);let i=(yield Promise.all(t.map(f=>b(this,null,function*(){if(yield f._isAvailable())return f})))).filter(f=>f),o=i[0]||xt(ko),a=Ro(r,e.config.apiKey,e.name),l=null;for(let f of t)try{let m=yield f._get(a);if(m){let T=hr._fromJSON(e,m);f!==o&&(l=T),o=f;break}}catch{}let h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],l&&(yield o._set(a,l.toJSON())),yield Promise.all(t.map(f=>b(this,null,function*(){if(f!==o)try{yield f._remove(a)}catch{}}))),new n(o,e,r))})}};function zl(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(bm(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Em(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Rm(e))return"Blackberry";if(Cm(e))return"Webos";if(Tm(e))return"Safari";if((e.includes("chrome/")||Am(e))&&!e.includes("edge/"))return"Chrome";if(Sm(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Em(n=Se()){return/firefox\//i.test(n)}function Tm(n=Se()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Am(n=Se()){return/crios\//i.test(n)}function bm(n=Se()){return/iemobile/i.test(n)}function Sm(n=Se()){return/android/i.test(n)}function Rm(n=Se()){return/blackberry/i.test(n)}function Cm(n=Se()){return/webos/i.test(n)}function rh(n,e=[]){let t;switch(n){case"Browser":t=zl(Se());break;case"Worker":t=`${zl(Se())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${nn}/${r}`}var No=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,l)=>{try{let h=e(o);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return b(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Pm(t){return b(this,arguments,function*(n,e={}){return vi(n,"GET","/v2/passwordPolicy",Yl(n,e))})}var Dm=6,Oo=class{constructor(e){var t,r,i,o;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Dm,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,l;let h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(o=h.containsUppercaseLetter)!==null&&o!==void 0?o:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(l=h.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),h}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var xo=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yi(this),this.idTokenSubscription=new yi(this),this.beforeStateQueue=new No(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ql,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=xt(t)),this._initializationPromise=this.queue(()=>b(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield _i.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return b(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return b(this,null,function*(){try{let t=yield eh(this,{idToken:e}),r=yield hr._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return b(this,null,function*(){var t;if(tn(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=i?._redirectEventId,h=yield this.tryRedirectSignIn(e);(!a||a===l)&&h?.user&&(i=h.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return W(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return b(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return b(this,null,function*(){try{yield gi(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=dm()}_delete(){return b(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return b(this,null,function*(){if(tn(this.app))return Promise.reject(di(this));let t=e?Ve(e):null;return t&&W(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return b(this,null,function*(){if(!this._deleted)return e&&W(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>b(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return b(this,null,function*(){return tn(this.app)?Promise.reject(di(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return tn(this.app)?Promise.reject(di(this)):this.queue(()=>b(this,null,function*(){yield this.assertedPersistence.setPersistence(xt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return b(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return b(this,null,function*(){let e=yield Pm(this),t=new Oo(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Xe("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return b(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Im(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return b(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return b(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&xt(e)||this._popupRedirectResolver;W(t,this,"argument-error"),this.redirectPersistenceManager=yield _i.create(this,[xt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return b(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>b(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return b(this,null,function*(){if(e===this.currentUser)return this.queue(()=>b(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,l=this._isInitialized?Promise.resolve():this._initializationPromise;if(W(l,this,"internal-error"),l.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return b(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return W(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return b(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return b(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&um(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function km(n){return Ve(n)}var yi=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=bl(t=>this.observer=t)}get next(){return W(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Nm={loadJS(){return b(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Om(n){Nm=n}function xm(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Vm(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(xt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}var iI=xm("rcb"),sI=new Vt(3e4,6e4);var oI=new Vt(2e3,1e4);var aI=10*60*1e3;var cI=new Vt(3e4,6e4);var uI=new Vt(5e3,15e3);var lI=encodeURIComponent("fac");var Gl="@firebase/auth",Kl="1.7.3";var Vo=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return b(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){W(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Lm(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Mm(n){gt(new Pe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;W(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rh(n)},f=new xo(r,i,o,h);return Vm(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),gt(new Pe("auth-internal",e=>{let t=km(e.getProvider("auth").getImmediate());return(r=>new Vo(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ce(Gl,Kl,Lm(n)),ce(Gl,Kl,"esm2017")}var Fm=5*60,hI=yl("authIdTokenMaxAge")||Fm;function Um(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Om({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=Lo("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",Um().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Mm("Browser");var Fg="auth";var Ii=class{constructor(){return ir(Fg)}};var ih=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},sh={};var yt,Bo;(function(){var n;function e(v,p){function _(){}_.prototype=p.prototype,v.D=p.prototype,v.prototype=new _,v.prototype.constructor=v,v.C=function(y,I,E){for(var g=Array(arguments.length-2),Ge=2;Ge<arguments.length;Ge++)g[Ge-2]=arguments[Ge];return p.prototype[I].apply(y,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,_){_||(_=0);var y=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)y[I]=p.charCodeAt(_++)|p.charCodeAt(_++)<<8|p.charCodeAt(_++)<<16|p.charCodeAt(_++)<<24;else for(I=0;16>I;++I)y[I]=p[_++]|p[_++]<<8|p[_++]<<16|p[_++]<<24;p=v.g[0],_=v.g[1],I=v.g[2];var E=v.g[3],g=p+(E^_&(I^E))+y[0]+3614090360&4294967295;p=_+(g<<7&4294967295|g>>>25),g=E+(I^p&(_^I))+y[1]+3905402710&4294967295,E=p+(g<<12&4294967295|g>>>20),g=I+(_^E&(p^_))+y[2]+606105819&4294967295,I=E+(g<<17&4294967295|g>>>15),g=_+(p^I&(E^p))+y[3]+3250441966&4294967295,_=I+(g<<22&4294967295|g>>>10),g=p+(E^_&(I^E))+y[4]+4118548399&4294967295,p=_+(g<<7&4294967295|g>>>25),g=E+(I^p&(_^I))+y[5]+1200080426&4294967295,E=p+(g<<12&4294967295|g>>>20),g=I+(_^E&(p^_))+y[6]+2821735955&4294967295,I=E+(g<<17&4294967295|g>>>15),g=_+(p^I&(E^p))+y[7]+4249261313&4294967295,_=I+(g<<22&4294967295|g>>>10),g=p+(E^_&(I^E))+y[8]+1770035416&4294967295,p=_+(g<<7&4294967295|g>>>25),g=E+(I^p&(_^I))+y[9]+2336552879&4294967295,E=p+(g<<12&4294967295|g>>>20),g=I+(_^E&(p^_))+y[10]+4294925233&4294967295,I=E+(g<<17&4294967295|g>>>15),g=_+(p^I&(E^p))+y[11]+2304563134&4294967295,_=I+(g<<22&4294967295|g>>>10),g=p+(E^_&(I^E))+y[12]+1804603682&4294967295,p=_+(g<<7&4294967295|g>>>25),g=E+(I^p&(_^I))+y[13]+4254626195&4294967295,E=p+(g<<12&4294967295|g>>>20),g=I+(_^E&(p^_))+y[14]+2792965006&4294967295,I=E+(g<<17&4294967295|g>>>15),g=_+(p^I&(E^p))+y[15]+1236535329&4294967295,_=I+(g<<22&4294967295|g>>>10),g=p+(I^E&(_^I))+y[1]+4129170786&4294967295,p=_+(g<<5&4294967295|g>>>27),g=E+(_^I&(p^_))+y[6]+3225465664&4294967295,E=p+(g<<9&4294967295|g>>>23),g=I+(p^_&(E^p))+y[11]+643717713&4294967295,I=E+(g<<14&4294967295|g>>>18),g=_+(E^p&(I^E))+y[0]+3921069994&4294967295,_=I+(g<<20&4294967295|g>>>12),g=p+(I^E&(_^I))+y[5]+3593408605&4294967295,p=_+(g<<5&4294967295|g>>>27),g=E+(_^I&(p^_))+y[10]+38016083&4294967295,E=p+(g<<9&4294967295|g>>>23),g=I+(p^_&(E^p))+y[15]+3634488961&4294967295,I=E+(g<<14&4294967295|g>>>18),g=_+(E^p&(I^E))+y[4]+3889429448&4294967295,_=I+(g<<20&4294967295|g>>>12),g=p+(I^E&(_^I))+y[9]+568446438&4294967295,p=_+(g<<5&4294967295|g>>>27),g=E+(_^I&(p^_))+y[14]+3275163606&4294967295,E=p+(g<<9&4294967295|g>>>23),g=I+(p^_&(E^p))+y[3]+4107603335&4294967295,I=E+(g<<14&4294967295|g>>>18),g=_+(E^p&(I^E))+y[8]+1163531501&4294967295,_=I+(g<<20&4294967295|g>>>12),g=p+(I^E&(_^I))+y[13]+2850285829&4294967295,p=_+(g<<5&4294967295|g>>>27),g=E+(_^I&(p^_))+y[2]+4243563512&4294967295,E=p+(g<<9&4294967295|g>>>23),g=I+(p^_&(E^p))+y[7]+1735328473&4294967295,I=E+(g<<14&4294967295|g>>>18),g=_+(E^p&(I^E))+y[12]+2368359562&4294967295,_=I+(g<<20&4294967295|g>>>12),g=p+(_^I^E)+y[5]+4294588738&4294967295,p=_+(g<<4&4294967295|g>>>28),g=E+(p^_^I)+y[8]+2272392833&4294967295,E=p+(g<<11&4294967295|g>>>21),g=I+(E^p^_)+y[11]+1839030562&4294967295,I=E+(g<<16&4294967295|g>>>16),g=_+(I^E^p)+y[14]+4259657740&4294967295,_=I+(g<<23&4294967295|g>>>9),g=p+(_^I^E)+y[1]+2763975236&4294967295,p=_+(g<<4&4294967295|g>>>28),g=E+(p^_^I)+y[4]+1272893353&4294967295,E=p+(g<<11&4294967295|g>>>21),g=I+(E^p^_)+y[7]+4139469664&4294967295,I=E+(g<<16&4294967295|g>>>16),g=_+(I^E^p)+y[10]+3200236656&4294967295,_=I+(g<<23&4294967295|g>>>9),g=p+(_^I^E)+y[13]+681279174&4294967295,p=_+(g<<4&4294967295|g>>>28),g=E+(p^_^I)+y[0]+3936430074&4294967295,E=p+(g<<11&4294967295|g>>>21),g=I+(E^p^_)+y[3]+3572445317&4294967295,I=E+(g<<16&4294967295|g>>>16),g=_+(I^E^p)+y[6]+76029189&4294967295,_=I+(g<<23&4294967295|g>>>9),g=p+(_^I^E)+y[9]+3654602809&4294967295,p=_+(g<<4&4294967295|g>>>28),g=E+(p^_^I)+y[12]+3873151461&4294967295,E=p+(g<<11&4294967295|g>>>21),g=I+(E^p^_)+y[15]+530742520&4294967295,I=E+(g<<16&4294967295|g>>>16),g=_+(I^E^p)+y[2]+3299628645&4294967295,_=I+(g<<23&4294967295|g>>>9),g=p+(I^(_|~E))+y[0]+4096336452&4294967295,p=_+(g<<6&4294967295|g>>>26),g=E+(_^(p|~I))+y[7]+1126891415&4294967295,E=p+(g<<10&4294967295|g>>>22),g=I+(p^(E|~_))+y[14]+2878612391&4294967295,I=E+(g<<15&4294967295|g>>>17),g=_+(E^(I|~p))+y[5]+4237533241&4294967295,_=I+(g<<21&4294967295|g>>>11),g=p+(I^(_|~E))+y[12]+1700485571&4294967295,p=_+(g<<6&4294967295|g>>>26),g=E+(_^(p|~I))+y[3]+2399980690&4294967295,E=p+(g<<10&4294967295|g>>>22),g=I+(p^(E|~_))+y[10]+4293915773&4294967295,I=E+(g<<15&4294967295|g>>>17),g=_+(E^(I|~p))+y[1]+2240044497&4294967295,_=I+(g<<21&4294967295|g>>>11),g=p+(I^(_|~E))+y[8]+1873313359&4294967295,p=_+(g<<6&4294967295|g>>>26),g=E+(_^(p|~I))+y[15]+4264355552&4294967295,E=p+(g<<10&4294967295|g>>>22),g=I+(p^(E|~_))+y[6]+2734768916&4294967295,I=E+(g<<15&4294967295|g>>>17),g=_+(E^(I|~p))+y[13]+1309151649&4294967295,_=I+(g<<21&4294967295|g>>>11),g=p+(I^(_|~E))+y[4]+4149444226&4294967295,p=_+(g<<6&4294967295|g>>>26),g=E+(_^(p|~I))+y[11]+3174756917&4294967295,E=p+(g<<10&4294967295|g>>>22),g=I+(p^(E|~_))+y[2]+718787259&4294967295,I=E+(g<<15&4294967295|g>>>17),g=_+(E^(I|~p))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(I+(g<<21&4294967295|g>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+E&4294967295}r.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var _=p-this.blockSize,y=this.B,I=this.h,E=0;E<p;){if(I==0)for(;E<=_;)i(this,v,E),E+=this.blockSize;if(typeof v=="string"){for(;E<p;)if(y[I++]=v.charCodeAt(E++),I==this.blockSize){i(this,y),I=0;break}}else for(;E<p;)if(y[I++]=v[E++],I==this.blockSize){i(this,y),I=0;break}}this.h=I,this.o+=p},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var _=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=_&255,_/=256;for(this.u(v),v=Array(16),p=_=0;4>p;++p)for(var y=0;32>y;y+=8)v[_++]=this.g[p]>>>y&255;return v};function o(v,p){var _=l;return Object.prototype.hasOwnProperty.call(_,v)?_[v]:_[v]=p(v)}function a(v,p){this.h=p;for(var _=[],y=!0,I=v.length-1;0<=I;I--){var E=v[I]|0;y&&E==p||(_[I]=E,y=!1)}this.g=_}var l={};function h(v){return-128<=v&&128>v?o(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return T;if(0>v)return k(f(-v));for(var p=[],_=1,y=0;v>=_;y++)p[y]=v/_|0,_*=4294967296;return new a(p,0)}function m(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return k(m(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=f(Math.pow(p,8)),y=T,I=0;I<v.length;I+=8){var E=Math.min(8,v.length-I),g=parseInt(v.substring(I,I+E),p);8>E?(E=f(Math.pow(p,E)),y=y.j(E).add(f(g))):(y=y.j(_),y=y.add(f(g)))}return y}var T=h(0),S=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-k(this).m();for(var v=0,p=1,_=0;_<this.g.length;_++){var y=this.i(_);v+=(0<=y?y:4294967296+y)*p,p*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(N(this))return"0";if(x(this))return"-"+k(this).toString(v);for(var p=f(Math.pow(v,6)),_=this,y="";;){var I=X(_,p).g;_=$(_,I.j(p));var E=((0<_.g.length?_.g[0]:_.h)>>>0).toString(v);if(_=I,N(_))return E+y;for(;6>E.length;)E="0"+E;y=E+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function N(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function x(v){return v.h==-1}n.l=function(v){return v=$(this,v),x(v)?-1:N(v)?0:1};function k(v){for(var p=v.g.length,_=[],y=0;y<p;y++)_[y]=~v.g[y];return new a(_,~v.h).add(S)}n.abs=function(){return x(this)?k(this):this},n.add=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0,I=0;I<=p;I++){var E=y+(this.i(I)&65535)+(v.i(I)&65535),g=(E>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);y=g>>>16,E&=65535,g&=65535,_[I]=g<<16|E}return new a(_,_[_.length-1]&-2147483648?-1:0)};function $(v,p){return v.add(k(p))}n.j=function(v){if(N(this)||N(v))return T;if(x(this))return x(v)?k(this).j(k(v)):k(k(this).j(v));if(x(v))return k(this.j(k(v)));if(0>this.l(R)&&0>v.l(R))return f(this.m()*v.m());for(var p=this.g.length+v.g.length,_=[],y=0;y<2*p;y++)_[y]=0;for(y=0;y<this.g.length;y++)for(var I=0;I<v.g.length;I++){var E=this.i(y)>>>16,g=this.i(y)&65535,Ge=v.i(I)>>>16,Pn=v.i(I)&65535;_[2*y+2*I]+=g*Pn,j(_,2*y+2*I),_[2*y+2*I+1]+=E*Pn,j(_,2*y+2*I+1),_[2*y+2*I+1]+=g*Ge,j(_,2*y+2*I+1),_[2*y+2*I+2]+=E*Ge,j(_,2*y+2*I+2)}for(y=0;y<p;y++)_[y]=_[2*y+1]<<16|_[2*y];for(y=p;y<2*p;y++)_[y]=0;return new a(_,0)};function j(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function z(v,p){this.g=v,this.h=p}function X(v,p){if(N(p))throw Error("division by zero");if(N(v))return new z(T,T);if(x(v))return p=X(k(v),p),new z(k(p.g),k(p.h));if(x(p))return p=X(v,k(p)),new z(k(p.g),p.h);if(30<v.g.length){if(x(v)||x(p))throw Error("slowDivide_ only works with positive integers.");for(var _=S,y=p;0>=y.l(v);)_=ye(_),y=ye(y);var I=Q(_,1),E=Q(y,1);for(y=Q(y,2),_=Q(_,2);!N(y);){var g=E.add(y);0>=g.l(v)&&(I=I.add(_),E=g),y=Q(y,1),_=Q(_,1)}return p=$(v,I.j(p)),new z(I,p)}for(I=T;0<=v.l(p);){for(_=Math.max(1,Math.floor(v.m()/p.m())),y=Math.ceil(Math.log(_)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),E=f(_),g=E.j(p);x(g)||0<g.l(v);)_-=y,E=f(_),g=E.j(p);N(E)&&(E=S),I=I.add(E),v=$(v,g)}return new z(I,v)}n.A=function(v){return X(this,v).h},n.and=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)&v.i(y);return new a(_,this.h&v.h)},n.or=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)|v.i(y);return new a(_,this.h|v.h)},n.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)^v.i(y);return new a(_,this.h^v.h)};function ye(v){for(var p=v.g.length+1,_=[],y=0;y<p;y++)_[y]=v.i(y)<<1|v.i(y-1)>>>31;return new a(_,v.h)}function Q(v,p){var _=p>>5;p%=32;for(var y=v.g.length-_,I=[],E=0;E<y;E++)I[E]=0<p?v.i(E+_)>>>p|v.i(E+_+1)<<32-p:v.i(E+_);return new a(I,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Bo=sh.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,yt=sh.Integer=a}).apply(typeof ih<"u"?ih:typeof self<"u"?self:typeof window<"u"?window:{});var wi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},et={};var qo,$o,on,jo,dr,Ei,zo,Go,Ko;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,c,u){return s==Array.prototype||s==Object.prototype||(s[c]=u.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof wi=="object"&&wi];for(var c=0;c<s.length;++c){var u=s[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var u=r;s=s.split(".");for(var d=0;d<s.length-1;d++){var w=s[d];if(!(w in u))break e;u=u[w]}s=s[s.length-1],d=u[s],c=c(d),c!=d&&c!=null&&e(u,s,{configurable:!0,writable:!0,value:c})}}function o(s,c){s instanceof String&&(s+="");var u=0,d=!1,w={next:function(){if(!d&&u<s.length){var A=u++;return{value:c(A,s[A]),done:!1}}return d=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}i("Array.prototype.values",function(s){return s||function(){return o(this,function(c,u){return u})}});var a=a||{},l=this||self;function h(s){var c=typeof s;return c=c!="object"?c:s?Array.isArray(s)?"array":c:"null",c=="array"||c=="object"&&typeof s.length=="number"}function f(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function m(s,c,u){return s.call.apply(s.bind,arguments)}function T(s,c,u){if(!s)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,d),s.apply(c,w)}}return function(){return s.apply(c,arguments)}}function S(s,c,u){return S=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:T,S.apply(null,arguments)}function R(s,c){var u=Array.prototype.slice.call(arguments,1);return function(){var d=u.slice();return d.push.apply(d,arguments),s.apply(this,d)}}function N(s,c){function u(){}u.prototype=c.prototype,s.aa=c.prototype,s.prototype=new u,s.prototype.constructor=s,s.Qb=function(d,w,A){for(var D=Array(arguments.length-2),J=2;J<arguments.length;J++)D[J-2]=arguments[J];return c.prototype[w].apply(d,D)}}function x(s){let c=s.length;if(0<c){let u=Array(c);for(let d=0;d<c;d++)u[d]=s[d];return u}return[]}function k(s,c){for(let u=1;u<arguments.length;u++){let d=arguments[u];if(h(d)){let w=s.length||0,A=d.length||0;s.length=w+A;for(let D=0;D<A;D++)s[w+D]=d[D]}else s.push(d)}}class ${constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function j(s){return/^[\s\xa0]*$/.test(s)}function z(){var s=l.navigator;return s&&(s=s.userAgent)?s:""}function X(s){return X[" "](s),s}X[" "]=function(){};var ye=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function Q(s,c,u){for(let d in s)c.call(u,s[d],d,s)}function v(s,c){for(let u in s)c.call(void 0,s[u],u,s)}function p(s){let c={};for(let u in s)c[u]=s[u];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(s,c){let u,d;for(let w=1;w<arguments.length;w++){d=arguments[w];for(u in d)s[u]=d[u];for(let A=0;A<_.length;A++)u=_[A],Object.prototype.hasOwnProperty.call(d,u)&&(s[u]=d[u])}}function I(s){var c=1;s=s.split(":");let u=[];for(;0<c&&s.length;)u.push(s.shift()),c--;return s.length&&u.push(s.join(":")),u}function E(s){l.setTimeout(()=>{throw s},0)}function g(){var s=as;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class Ge{constructor(){this.h=this.g=null}add(c,u){let d=Pn.get();d.set(c,u),this.h?this.h.next=d:this.g=d,this.h=d}}var Pn=new $(()=>new $d,s=>s.reset());class $d{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let Dn,kn=!1,as=new Ge,Qc=()=>{let s=l.Promise.resolve(void 0);Dn=()=>{s.then(jd)}};var jd=()=>{for(var s;s=g();){try{s.h.call(s.g)}catch(u){E(u)}var c=Pn;c.j(s),100>c.h&&(c.h++,s.next=c.g,c.g=s)}kn=!1};function st(){this.s=this.s,this.C=this.C}st.prototype.s=!1,st.prototype.ma=function(){this.s||(this.s=!0,this.N())},st.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function de(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}de.prototype.h=function(){this.defaultPrevented=!0};var zd=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let u=()=>{};l.addEventListener("test",u,c),l.removeEventListener("test",u,c)}catch{}return s}();function Nn(s,c){if(de.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var u=this.type=s.type,d=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget){if(ye){e:{try{X(c.nodeName);var w=!0;break e}catch{}w=!1}w||(c=null)}}else u=="mouseover"?c=s.fromElement:u=="mouseout"&&(c=s.toElement);this.relatedTarget=c,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:Gd[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Nn.aa.h.call(this)}}N(Nn,de);var Gd={2:"touch",3:"pen",4:"mouse"};Nn.prototype.h=function(){Nn.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var On="closure_listenable_"+(1e6*Math.random()|0),Kd=0;function Wd(s,c,u,d,w){this.listener=s,this.proxy=null,this.src=c,this.type=u,this.capture=!!d,this.ha=w,this.key=++Kd,this.da=this.fa=!1}function Mr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Fr(s){this.src=s,this.g={},this.h=0}Fr.prototype.add=function(s,c,u,d,w){var A=s.toString();s=this.g[A],s||(s=this.g[A]=[],this.h++);var D=us(s,c,d,w);return-1<D?(c=s[D],u||(c.fa=!1)):(c=new Wd(c,this.src,A,!!d,w),c.fa=u,s.push(c)),c};function cs(s,c){var u=c.type;if(u in s.g){var d=s.g[u],w=Array.prototype.indexOf.call(d,c,void 0),A;(A=0<=w)&&Array.prototype.splice.call(d,w,1),A&&(Mr(c),s.g[u].length==0&&(delete s.g[u],s.h--))}}function us(s,c,u,d){for(var w=0;w<s.length;++w){var A=s[w];if(!A.da&&A.listener==c&&A.capture==!!u&&A.ha==d)return w}return-1}var ls="closure_lm_"+(1e6*Math.random()|0),hs={};function Jc(s,c,u,d,w){if(d&&d.once)return Xc(s,c,u,d,w);if(Array.isArray(c)){for(var A=0;A<c.length;A++)Jc(s,c[A],u,d,w);return null}return u=ms(u),s&&s[On]?s.K(c,u,f(d)?!!d.capture:!!d,w):Yc(s,c,u,!1,d,w)}function Yc(s,c,u,d,w,A){if(!c)throw Error("Invalid event type");var D=f(w)?!!w.capture:!!w,J=fs(s);if(J||(s[ls]=J=new Fr(s)),u=J.add(c,u,d,D,A),u.proxy)return u;if(d=Hd(),u.proxy=d,d.src=s,d.listener=u,s.addEventListener)zd||(w=D),w===void 0&&(w=!1),s.addEventListener(c.toString(),d,w);else if(s.attachEvent)s.attachEvent(eu(c.toString()),d);else if(s.addListener&&s.removeListener)s.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return u}function Hd(){function s(u){return c.call(s.src,s.listener,u)}let c=Qd;return s}function Xc(s,c,u,d,w){if(Array.isArray(c)){for(var A=0;A<c.length;A++)Xc(s,c[A],u,d,w);return null}return u=ms(u),s&&s[On]?s.L(c,u,f(d)?!!d.capture:!!d,w):Yc(s,c,u,!0,d,w)}function Zc(s,c,u,d,w){if(Array.isArray(c))for(var A=0;A<c.length;A++)Zc(s,c[A],u,d,w);else d=f(d)?!!d.capture:!!d,u=ms(u),s&&s[On]?(s=s.i,c=String(c).toString(),c in s.g&&(A=s.g[c],u=us(A,u,d,w),-1<u&&(Mr(A[u]),Array.prototype.splice.call(A,u,1),A.length==0&&(delete s.g[c],s.h--)))):s&&(s=fs(s))&&(c=s.g[c.toString()],s=-1,c&&(s=us(c,u,d,w)),(u=-1<s?c[s]:null)&&ds(u))}function ds(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[On])cs(c.i,s);else{var u=s.type,d=s.proxy;c.removeEventListener?c.removeEventListener(u,d,s.capture):c.detachEvent?c.detachEvent(eu(u),d):c.addListener&&c.removeListener&&c.removeListener(d),(u=fs(c))?(cs(u,s),u.h==0&&(u.src=null,c[ls]=null)):Mr(s)}}}function eu(s){return s in hs?hs[s]:hs[s]="on"+s}function Qd(s,c){if(s.da)s=!0;else{c=new Nn(c,this);var u=s.listener,d=s.ha||s.src;s.fa&&ds(s),s=u.call(d,c)}return s}function fs(s){return s=s[ls],s instanceof Fr?s:null}var ps="__closure_events_fn_"+(1e9*Math.random()>>>0);function ms(s){return typeof s=="function"?s:(s[ps]||(s[ps]=function(c){return s.handleEvent(c)}),s[ps])}function fe(){st.call(this),this.i=new Fr(this),this.M=this,this.F=null}N(fe,st),fe.prototype[On]=!0,fe.prototype.removeEventListener=function(s,c,u,d){Zc(this,s,c,u,d)};function ve(s,c){var u,d=s.F;if(d)for(u=[];d;d=d.F)u.push(d);if(s=s.M,d=c.type||c,typeof c=="string")c=new de(c,s);else if(c instanceof de)c.target=c.target||s;else{var w=c;c=new de(d,s),y(c,w)}if(w=!0,u)for(var A=u.length-1;0<=A;A--){var D=c.g=u[A];w=Ur(D,d,!0,c)&&w}if(D=c.g=s,w=Ur(D,d,!0,c)&&w,w=Ur(D,d,!1,c)&&w,u)for(A=0;A<u.length;A++)D=c.g=u[A],w=Ur(D,d,!1,c)&&w}fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var s=this.i,c;for(c in s.g){for(var u=s.g[c],d=0;d<u.length;d++)Mr(u[d]);delete s.g[c],s.h--}}this.F=null},fe.prototype.K=function(s,c,u,d){return this.i.add(String(s),c,!1,u,d)},fe.prototype.L=function(s,c,u,d){return this.i.add(String(s),c,!0,u,d)};function Ur(s,c,u,d){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();for(var w=!0,A=0;A<c.length;++A){var D=c[A];if(D&&!D.da&&D.capture==u){var J=D.listener,le=D.ha||D.src;D.fa&&cs(s.i,D),w=J.call(le,d)!==!1&&w}}return w&&!d.defaultPrevented}function tu(s,c,u){if(typeof s=="function")u&&(s=S(s,u));else if(s&&typeof s.handleEvent=="function")s=S(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(s,c||0)}function nu(s){s.g=tu(()=>{s.g=null,s.i&&(s.i=!1,nu(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class Jd extends st{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:nu(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xn(s){st.call(this),this.h=s,this.g={}}N(xn,st);var ru=[];function iu(s){Q(s.g,function(c,u){this.g.hasOwnProperty(u)&&ds(c)},s),s.g={}}xn.prototype.N=function(){xn.aa.N.call(this),iu(this)},xn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var gs=l.JSON.stringify,Yd=l.JSON.parse,Xd=class{stringify(s){return l.JSON.stringify(s,void 0)}parse(s){return l.JSON.parse(s,void 0)}};function _s(){}_s.prototype.h=null;function su(s){return s.h||(s.h=s.i())}function ou(){}var Vn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ys(){de.call(this,"d")}N(ys,de);function vs(){de.call(this,"c")}N(vs,de);var Tt={},au=null;function Br(){return au=au||new fe}Tt.La="serverreachability";function cu(s){de.call(this,Tt.La,s)}N(cu,de);function Ln(s){let c=Br();ve(c,new cu(c))}Tt.STAT_EVENT="statevent";function uu(s,c){de.call(this,Tt.STAT_EVENT,s),this.stat=c}N(uu,de);function Ie(s){let c=Br();ve(c,new uu(c,s))}Tt.Ma="timingevent";function lu(s,c){de.call(this,Tt.Ma,s),this.size=c}N(lu,de);function Mn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){s()},c)}function Fn(){this.g=!0}Fn.prototype.xa=function(){this.g=!1};function Zd(s,c,u,d,w,A){s.info(function(){if(s.g)if(A)for(var D="",J=A.split("&"),le=0;le<J.length;le++){var K=J[le].split("=");if(1<K.length){var pe=K[0];K=K[1];var me=pe.split("_");D=2<=me.length&&me[1]=="type"?D+(pe+"="+K+"&"):D+(pe+"=redacted&")}}else D=null;else D=A;return"XMLHTTP REQ ("+d+") [attempt "+w+"]: "+c+`
`+u+`
`+D})}function ef(s,c,u,d,w,A,D){s.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+w+"]: "+c+`
`+u+`
`+A+" "+D})}function Gt(s,c,u,d){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+nf(s,u)+(d?" "+d:"")})}function tf(s,c){s.info(function(){return"TIMEOUT: "+c})}Fn.prototype.info=function(){};function nf(s,c){if(!s.g)return c;if(!c)return null;try{var u=JSON.parse(c);if(u){for(s=0;s<u.length;s++)if(Array.isArray(u[s])){var d=u[s];if(!(2>d.length)){var w=d[1];if(Array.isArray(w)&&!(1>w.length)){var A=w[0];if(A!="noop"&&A!="stop"&&A!="close")for(var D=1;D<w.length;D++)w[D]=""}}}}return gs(u)}catch{return c}}var qr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},hu={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Is;function $r(){}N($r,_s),$r.prototype.g=function(){return new XMLHttpRequest},$r.prototype.i=function(){return{}},Is=new $r;function ot(s,c,u,d){this.j=s,this.i=c,this.l=u,this.R=d||1,this.U=new xn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new du}function du(){this.i=null,this.g="",this.h=!1}var fu={},ws={};function Es(s,c,u){s.L=1,s.v=Kr(Ke(c)),s.m=u,s.P=!0,pu(s,null)}function pu(s,c){s.F=Date.now(),jr(s),s.A=Ke(s.v);var u=s.A,d=s.R;Array.isArray(d)||(d=[String(d)]),Cu(u.i,"t",d),s.C=0,u=s.j.J,s.h=new du,s.g=Ku(s.j,u?c:null,!s.m),0<s.O&&(s.M=new Jd(S(s.Y,s,s.g),s.O)),c=s.U,u=s.g,d=s.ca;var w="readystatechange";Array.isArray(w)||(w&&(ru[0]=w.toString()),w=ru);for(var A=0;A<w.length;A++){var D=Jc(u,w[A],d||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=s.H?p(s.H):{},s.m?(s.u||(s.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,c)):(s.u="GET",s.g.ea(s.A,s.u,null,c)),Ln(),Zd(s.i,s.u,s.A,s.l,s.R,s.m)}ot.prototype.ca=function(s){s=s.target;let c=this.M;c&&We(s)==3?c.j():this.Y(s)},ot.prototype.Y=function(s){try{if(s==this.g)e:{let me=We(this.g);var c=this.g.Ba();let Ht=this.g.Z();if(!(3>me)&&(me!=3||this.g&&(this.h.h||this.g.oa()||Vu(this.g)))){this.J||me!=4||c==7||(c==8||0>=Ht?Ln(3):Ln(2)),Ts(this);var u=this.g.Z();this.X=u;t:if(mu(this)){var d=Vu(this.g);s="";var w=d.length,A=We(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){At(this),Un(this);var D="";break t}this.h.i=new l.TextDecoder}for(c=0;c<w;c++)this.h.h=!0,s+=this.h.i.decode(d[c],{stream:!(A&&c==w-1)});d.length=0,this.h.g+=s,this.C=0,D=this.h.g}else D=this.g.oa();if(this.o=u==200,ef(this.i,this.u,this.A,this.l,this.R,me,u),this.o){if(this.T&&!this.K){t:{if(this.g){var J,le=this.g;if((J=le.g?le.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(J)){var K=J;break t}}K=null}if(u=K)Gt(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,As(this,u);else{this.o=!1,this.s=3,Ie(12),At(this),Un(this);break e}}if(this.P){u=!0;let ke;for(;!this.J&&this.C<D.length;)if(ke=rf(this,D),ke==ws){me==4&&(this.s=4,Ie(14),u=!1),Gt(this.i,this.l,null,"[Incomplete Response]");break}else if(ke==fu){this.s=4,Ie(15),Gt(this.i,this.l,D,"[Invalid Chunk]"),u=!1;break}else Gt(this.i,this.l,ke,null),As(this,ke);if(mu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),me!=4||D.length!=0||this.h.h||(this.s=1,Ie(16),u=!1),this.o=this.o&&u,!u)Gt(this.i,this.l,D,"[Invalid Chunked Response]"),At(this),Un(this);else if(0<D.length&&!this.W){this.W=!0;var pe=this.j;pe.g==this&&pe.ba&&!pe.M&&(pe.j.info("Great, no buffering proxy detected. Bytes received: "+D.length),Ds(pe),pe.M=!0,Ie(11))}}else Gt(this.i,this.l,D,null),As(this,D);me==4&&At(this),this.o&&!this.J&&(me==4?$u(this.j,this):(this.o=!1,jr(this)))}else wf(this.g),u==400&&0<D.indexOf("Unknown SID")?(this.s=3,Ie(12)):(this.s=0,Ie(13)),At(this),Un(this)}}}catch{}finally{}};function mu(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function rf(s,c){var u=s.C,d=c.indexOf(`
`,u);return d==-1?ws:(u=Number(c.substring(u,d)),isNaN(u)?fu:(d+=1,d+u>c.length?ws:(c=c.slice(d,d+u),s.C=d+u,c)))}ot.prototype.cancel=function(){this.J=!0,At(this)};function jr(s){s.S=Date.now()+s.I,gu(s,s.I)}function gu(s,c){if(s.B!=null)throw Error("WatchDog timer not null");s.B=Mn(S(s.ba,s),c)}function Ts(s){s.B&&(l.clearTimeout(s.B),s.B=null)}ot.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(tf(this.i,this.A),this.L!=2&&(Ln(),Ie(17)),At(this),this.s=2,Un(this)):gu(this,this.S-s)};function Un(s){s.j.G==0||s.J||$u(s.j,s)}function At(s){Ts(s);var c=s.M;c&&typeof c.ma=="function"&&c.ma(),s.M=null,iu(s.U),s.g&&(c=s.g,s.g=null,c.abort(),c.ma())}function As(s,c){try{var u=s.j;if(u.G!=0&&(u.g==s||bs(u.h,s))){if(!s.K&&bs(u.h,s)&&u.G==3){try{var d=u.Da.g.parse(c)}catch{d=null}if(Array.isArray(d)&&d.length==3){var w=d;if(w[0]==0){e:if(!u.u){if(u.g)if(u.g.F+3e3<s.F)Yr(u),Qr(u);else break e;Ps(u),Ie(18)}}else u.za=w[1],0<u.za-u.T&&37500>w[2]&&u.F&&u.v==0&&!u.C&&(u.C=Mn(S(u.Za,u),6e3));if(1>=vu(u.h)&&u.ca){try{u.ca()}catch{}u.ca=void 0}}else St(u,11)}else if((s.K||u.g==s)&&Yr(u),!j(c))for(w=u.Da.g.parse(c),c=0;c<w.length;c++){let K=w[c];if(u.T=K[0],K=K[1],u.G==2)if(K[0]=="c"){u.K=K[1],u.ia=K[2];let pe=K[3];pe!=null&&(u.la=pe,u.j.info("VER="+u.la));let me=K[4];me!=null&&(u.Aa=me,u.j.info("SVER="+u.Aa));let Ht=K[5];Ht!=null&&typeof Ht=="number"&&0<Ht&&(d=1.5*Ht,u.L=d,u.j.info("backChannelRequestTimeoutMs_="+d)),d=u;let ke=s.g;if(ke){let Zr=ke.g?ke.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Zr){var A=d.h;A.g||Zr.indexOf("spdy")==-1&&Zr.indexOf("quic")==-1&&Zr.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(Ss(A,A.h),A.h=null))}if(d.D){let ks=ke.g?ke.g.getResponseHeader("X-HTTP-Session-Id"):null;ks&&(d.ya=ks,Z(d.I,d.D,ks))}}u.G=3,u.l&&u.l.ua(),u.ba&&(u.R=Date.now()-s.F,u.j.info("Handshake RTT: "+u.R+"ms")),d=u;var D=s;if(d.qa=Gu(d,d.J?d.ia:null,d.W),D.K){Iu(d.h,D);var J=D,le=d.L;le&&(J.I=le),J.B&&(Ts(J),jr(J)),d.g=D}else Bu(d);0<u.i.length&&Jr(u)}else K[0]!="stop"&&K[0]!="close"||St(u,7);else u.G==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?St(u,7):Cs(u):K[0]!="noop"&&u.l&&u.l.ta(K),u.v=0)}}Ln(4)}catch{}}var sf=class{constructor(s,c){this.g=s,this.map=c}};function _u(s){this.l=s||10,l.PerformanceNavigationTiming?(s=l.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function yu(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function vu(s){return s.h?1:s.g?s.g.size:0}function bs(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function Ss(s,c){s.g?s.g.add(c):s.h=c}function Iu(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}_u.prototype.cancel=function(){if(this.i=wu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function wu(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let u of s.g.values())c=c.concat(u.D);return c}return x(s.i)}function of(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var c=[],u=s.length,d=0;d<u;d++)c.push(s[d]);return c}c=[],u=0;for(d in s)c[u++]=s[d];return c}function af(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var c=[];s=s.length;for(var u=0;u<s;u++)c.push(u);return c}c=[],u=0;for(let d in s)c[u++]=d;return c}}}function Eu(s,c){if(s.forEach&&typeof s.forEach=="function")s.forEach(c,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,c,void 0);else for(var u=af(s),d=of(s),w=d.length,A=0;A<w;A++)c.call(void 0,d[A],u&&u[A],s)}var Tu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cf(s,c){if(s){s=s.split("&");for(var u=0;u<s.length;u++){var d=s[u].indexOf("="),w=null;if(0<=d){var A=s[u].substring(0,d);w=s[u].substring(d+1)}else A=s[u];c(A,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}function bt(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof bt){this.h=s.h,zr(this,s.j),this.o=s.o,this.g=s.g,Gr(this,s.s),this.l=s.l;var c=s.i,u=new $n;u.i=c.i,c.g&&(u.g=new Map(c.g),u.h=c.h),Au(this,u),this.m=s.m}else s&&(c=String(s).match(Tu))?(this.h=!1,zr(this,c[1]||"",!0),this.o=Bn(c[2]||""),this.g=Bn(c[3]||"",!0),Gr(this,c[4]),this.l=Bn(c[5]||"",!0),Au(this,c[6]||"",!0),this.m=Bn(c[7]||"")):(this.h=!1,this.i=new $n(null,this.h))}bt.prototype.toString=function(){var s=[],c=this.j;c&&s.push(qn(c,bu,!0),":");var u=this.g;return(u||c=="file")&&(s.push("//"),(c=this.o)&&s.push(qn(c,bu,!0),"@"),s.push(encodeURIComponent(String(u)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.s,u!=null&&s.push(":",String(u))),(u=this.l)&&(this.g&&u.charAt(0)!="/"&&s.push("/"),s.push(qn(u,u.charAt(0)=="/"?hf:lf,!0))),(u=this.i.toString())&&s.push("?",u),(u=this.m)&&s.push("#",qn(u,ff)),s.join("")};function Ke(s){return new bt(s)}function zr(s,c,u){s.j=u?Bn(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function Gr(s,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);s.s=c}else s.s=null}function Au(s,c,u){c instanceof $n?(s.i=c,pf(s.i,s.h)):(u||(c=qn(c,df)),s.i=new $n(c,s.h))}function Z(s,c,u){s.i.set(c,u)}function Kr(s){return Z(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function Bn(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function qn(s,c,u){return typeof s=="string"?(s=encodeURI(s).replace(c,uf),u&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function uf(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var bu=/[#\/\?@]/g,lf=/[#\?:]/g,hf=/[#\?]/g,df=/[#\?@]/g,ff=/#/g;function $n(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function at(s){s.g||(s.g=new Map,s.h=0,s.i&&cf(s.i,function(c,u){s.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=$n.prototype,n.add=function(s,c){at(this),this.i=null,s=Kt(this,s);var u=this.g.get(s);return u||this.g.set(s,u=[]),u.push(c),this.h+=1,this};function Su(s,c){at(s),c=Kt(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function Ru(s,c){return at(s),c=Kt(s,c),s.g.has(c)}n.forEach=function(s,c){at(this),this.g.forEach(function(u,d){u.forEach(function(w){s.call(c,w,d,this)},this)},this)},n.na=function(){at(this);let s=Array.from(this.g.values()),c=Array.from(this.g.keys()),u=[];for(let d=0;d<c.length;d++){let w=s[d];for(let A=0;A<w.length;A++)u.push(c[d])}return u},n.V=function(s){at(this);let c=[];if(typeof s=="string")Ru(this,s)&&(c=c.concat(this.g.get(Kt(this,s))));else{s=Array.from(this.g.values());for(let u=0;u<s.length;u++)c=c.concat(s[u])}return c},n.set=function(s,c){return at(this),this.i=null,s=Kt(this,s),Ru(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=this.V(s),0<s.length?String(s[0]):c):c};function Cu(s,c,u){Su(s,c),0<u.length&&(s.i=null,s.g.set(Kt(s,c),x(u)),s.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(var u=0;u<c.length;u++){var d=c[u];let A=encodeURIComponent(String(d)),D=this.V(d);for(d=0;d<D.length;d++){var w=A;D[d]!==""&&(w+="="+encodeURIComponent(String(D[d]))),s.push(w)}}return this.i=s.join("&")};function Kt(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function pf(s,c){c&&!s.j&&(at(s),s.i=null,s.g.forEach(function(u,d){var w=d.toLowerCase();d!=w&&(Su(this,d),Cu(this,w,u))},s)),s.j=c}function mf(s,c){let u=new Fn;if(l.Image){let d=new Image;d.onload=R(ct,u,"TestLoadImage: loaded",!0,c,d),d.onerror=R(ct,u,"TestLoadImage: error",!1,c,d),d.onabort=R(ct,u,"TestLoadImage: abort",!1,c,d),d.ontimeout=R(ct,u,"TestLoadImage: timeout",!1,c,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=s}else c(!1)}function gf(s,c){let u=new Fn,d=new AbortController,w=setTimeout(()=>{d.abort(),ct(u,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:d.signal}).then(A=>{clearTimeout(w),A.ok?ct(u,"TestPingServer: ok",!0,c):ct(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),ct(u,"TestPingServer: error",!1,c)})}function ct(s,c,u,d,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),d(u)}catch{}}function _f(){this.g=new Xd}function yf(s,c,u){let d=u||"";try{Eu(s,function(w,A){let D=w;f(w)&&(D=gs(w)),c.push(d+A+"="+encodeURIComponent(D))})}catch(w){throw c.push(d+"type="+encodeURIComponent("_badmap")),w}}function jn(s){this.l=s.Ub||null,this.j=s.eb||!1}N(jn,_s),jn.prototype.g=function(){return new Wr(this.l,this.j)},jn.prototype.i=function(s){return function(){return s}}({});function Wr(s,c){fe.call(this),this.D=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Wr,fe),n=Wr.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=c,this.readyState=1,Gn(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(c.body=s),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,zn(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Gn(this)),this.g&&(this.readyState=3,Gn(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pu(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Pu(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?zn(this):Gn(this),this.readyState==3&&Pu(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,zn(this))},n.Qa=function(s){this.g&&(this.response=s,zn(this))},n.ga=function(){this.g&&zn(this)};function zn(s){s.readyState=4,s.l=null,s.j=null,s.v=null,Gn(s)}n.setRequestHeader=function(s,c){this.u.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,s.push(u[0]+": "+u[1]),u=c.next();return s.join(`\r
`)};function Gn(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Wr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Du(s){let c="";return Q(s,function(u,d){c+=d,c+=":",c+=u,c+=`\r
`}),c}function Rs(s,c,u){e:{for(d in u){var d=!1;break e}d=!0}d||(u=Du(u),typeof s=="string"?u!=null&&encodeURIComponent(String(u)):Z(s,c,u))}function ee(s){fe.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(ee,fe);var vf=/^https?$/i,If=["POST","PUT"];n=ee.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,c,u,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Is.g(),this.v=this.o?su(this.o):su(Is),this.g.onreadystatechange=S(this.Ea,this);try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(A){ku(this,A);return}if(s=u||"",u=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var w in d)u.set(w,d[w]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let A of d.keys())u.set(A,d.get(A));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(u.keys()).find(A=>A.toLowerCase()=="content-type"),w=l.FormData&&s instanceof l.FormData,!(0<=Array.prototype.indexOf.call(If,c,void 0))||d||w||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[A,D]of u)this.g.setRequestHeader(A,D);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{xu(this),this.u=!0,this.g.send(s),this.u=!1}catch(A){ku(this,A)}};function ku(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.m=5,Nu(s),Hr(s)}function Nu(s){s.A||(s.A=!0,ve(s,"complete"),ve(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,ve(this,"complete"),ve(this,"abort"),Hr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hr(this,!0)),ee.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ou(this):this.bb())},n.bb=function(){Ou(this)};function Ou(s){if(s.h&&typeof a<"u"&&(!s.v[1]||We(s)!=4||s.Z()!=2)){if(s.u&&We(s)==4)tu(s.Ea,0,s);else if(ve(s,"readystatechange"),We(s)==4){s.h=!1;try{let D=s.Z();e:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var u;if(!(u=c)){var d;if(d=D===0){var w=String(s.D).match(Tu)[1]||null;!w&&l.self&&l.self.location&&(w=l.self.location.protocol.slice(0,-1)),d=!vf.test(w?w.toLowerCase():"")}u=d}if(u)ve(s,"complete"),ve(s,"success");else{s.m=6;try{var A=2<We(s)?s.g.statusText:""}catch{A=""}s.l=A+" ["+s.Z()+"]",Nu(s)}}finally{Hr(s)}}}}function Hr(s,c){if(s.g){xu(s);let u=s.g,d=s.v[0]?()=>{}:null;s.g=null,s.v=null,c||ve(s,"ready");try{u.onreadystatechange=d}catch{}}}function xu(s){s.I&&(l.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function We(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<We(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),Yd(c)}};function Vu(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function wf(s){let c={};s=(s.g&&2<=We(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<s.length;d++){if(j(s[d]))continue;var u=I(s[d]);let w=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();let A=c[w]||[];c[w]=A,A.push(u)}v(c,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Kn(s,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[s]||c}function Lu(s){this.Aa=0,this.i=[],this.j=new Fn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kn("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kn("baseRetryDelayMs",5e3,s),this.cb=Kn("retryDelaySeedMs",1e4,s),this.Wa=Kn("forwardChannelMaxRetries",2,s),this.wa=Kn("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new _u(s&&s.concurrentRequestLimit),this.Da=new _f,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Lu.prototype,n.la=8,n.G=1,n.connect=function(s,c,u,d){Ie(0),this.W=s,this.H=c||{},u&&d!==void 0&&(this.H.OSID=u,this.H.OAID=d),this.F=this.X,this.I=Gu(this,null,this.W),Jr(this)};function Cs(s){if(Mu(s),s.G==3){var c=s.U++,u=Ke(s.I);if(Z(u,"SID",s.K),Z(u,"RID",c),Z(u,"TYPE","terminate"),Wn(s,u),c=new ot(s,s.j,c),c.L=2,c.v=Kr(Ke(u)),u=!1,l.navigator&&l.navigator.sendBeacon)try{u=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!u&&l.Image&&(new Image().src=c.v,u=!0),u||(c.g=Ku(c.j,null),c.g.ea(c.v)),c.F=Date.now(),jr(c)}zu(s)}function Qr(s){s.g&&(Ds(s),s.g.cancel(),s.g=null)}function Mu(s){Qr(s),s.u&&(l.clearTimeout(s.u),s.u=null),Yr(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&l.clearTimeout(s.s),s.s=null)}function Jr(s){if(!yu(s.h)&&!s.s){s.s=!0;var c=s.Ga;Dn||Qc(),kn||(Dn(),kn=!0),as.add(c,s),s.B=0}}function Ef(s,c){return vu(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=c.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=Mn(S(s.Ga,s,c),ju(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let w=new ot(this,this.j,s),A=this.o;if(this.S&&(A?(A=p(A),y(A,this.S)):A=this.S),this.m!==null||this.O||(w.H=A,A=null),this.P)e:{for(var c=0,u=0;u<this.i.length;u++){t:{var d=this.i[u];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break t}d=void 0}if(d===void 0)break;if(c+=d,4096<c){c=u;break e}if(c===4096||u===this.i.length-1){c=u+1;break e}}c=1e3}else c=1e3;c=Uu(this,w,c),u=Ke(this.I),Z(u,"RID",s),Z(u,"CVER",22),this.D&&Z(u,"X-HTTP-Session-Id",this.D),Wn(this,u),A&&(this.O?c="headers="+encodeURIComponent(String(Du(A)))+"&"+c:this.m&&Rs(u,this.m,A)),Ss(this.h,w),this.Ua&&Z(u,"TYPE","init"),this.P?(Z(u,"$req",c),Z(u,"SID","null"),w.T=!0,Es(w,u,null)):Es(w,u,c),this.G=2}}else this.G==3&&(s?Fu(this,s):this.i.length==0||yu(this.h)||Fu(this))};function Fu(s,c){var u;c?u=c.l:u=s.U++;let d=Ke(s.I);Z(d,"SID",s.K),Z(d,"RID",u),Z(d,"AID",s.T),Wn(s,d),s.m&&s.o&&Rs(d,s.m,s.o),u=new ot(s,s.j,u,s.B+1),s.m===null&&(u.H=s.o),c&&(s.i=c.D.concat(s.i)),c=Uu(s,u,1e3),u.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),Ss(s.h,u),Es(u,d,c)}function Wn(s,c){s.H&&Q(s.H,function(u,d){Z(c,d,u)}),s.l&&Eu({},function(u,d){Z(c,d,u)})}function Uu(s,c,u){u=Math.min(s.i.length,u);var d=s.l?S(s.l.Na,s.l,s):null;e:{var w=s.i;let A=-1;for(;;){let D=["count="+u];A==-1?0<u?(A=w[0].g,D.push("ofs="+A)):A=0:D.push("ofs="+A);let J=!0;for(let le=0;le<u;le++){let K=w[le].g,pe=w[le].map;if(K-=A,0>K)A=Math.max(0,w[le].g-100),J=!1;else try{yf(pe,D,"req"+K+"_")}catch{d&&d(pe)}}if(J){d=D.join("&");break e}}}return s=s.i.splice(0,u),c.D=s,d}function Bu(s){if(!s.g&&!s.u){s.Y=1;var c=s.Fa;Dn||Qc(),kn||(Dn(),kn=!0),as.add(c,s),s.v=0}}function Ps(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=Mn(S(s.Fa,s),ju(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,qu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=Mn(S(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ie(10),Qr(this),qu(this))};function Ds(s){s.A!=null&&(l.clearTimeout(s.A),s.A=null)}function qu(s){s.g=new ot(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var c=Ke(s.qa);Z(c,"RID","rpc"),Z(c,"SID",s.K),Z(c,"AID",s.T),Z(c,"CI",s.F?"0":"1"),!s.F&&s.ja&&Z(c,"TO",s.ja),Z(c,"TYPE","xmlhttp"),Wn(s,c),s.m&&s.o&&Rs(c,s.m,s.o),s.L&&(s.g.I=s.L);var u=s.g;s=s.ia,u.L=1,u.v=Kr(Ke(c)),u.m=null,u.P=!0,pu(u,s)}n.Za=function(){this.C!=null&&(this.C=null,Qr(this),Ps(this),Ie(19))};function Yr(s){s.C!=null&&(l.clearTimeout(s.C),s.C=null)}function $u(s,c){var u=null;if(s.g==c){Yr(s),Ds(s),s.g=null;var d=2}else if(bs(s.h,c))u=c.D,Iu(s.h,c),d=1;else return;if(s.G!=0){if(c.o)if(d==1){u=c.m?c.m.length:0,c=Date.now()-c.F;var w=s.B;d=Br(),ve(d,new lu(d,u)),Jr(s)}else Bu(s);else if(w=c.s,w==3||w==0&&0<c.X||!(d==1&&Ef(s,c)||d==2&&Ps(s)))switch(u&&0<u.length&&(c=s.h,c.i=c.i.concat(u)),w){case 1:St(s,5);break;case 4:St(s,10);break;case 3:St(s,6);break;default:St(s,2)}}}function ju(s,c){let u=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(u*=2),u*c}function St(s,c){if(s.j.info("Error code "+c),c==2){var u=S(s.fb,s),d=s.Xa;let w=!d;d=new bt(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||zr(d,"https"),Kr(d),w?mf(d.toString(),u):gf(d.toString(),u)}else Ie(2);s.G=0,s.l&&s.l.sa(c),zu(s),Mu(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))};function zu(s){if(s.G=0,s.ka=[],s.l){let c=wu(s.h);(c.length!=0||s.i.length!=0)&&(k(s.ka,c),k(s.ka,s.i),s.h.i.length=0,x(s.i),s.i.length=0),s.l.ra()}}function Gu(s,c,u){var d=u instanceof bt?Ke(u):new bt(u);if(d.g!="")c&&(d.g=c+"."+d.g),Gr(d,d.s);else{var w=l.location;d=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;var A=new bt(null);d&&zr(A,d),c&&(A.g=c),w&&Gr(A,w),u&&(A.l=u),d=A}return u=s.D,c=s.ya,u&&c&&Z(d,u,c),Z(d,"VER",s.la),Wn(s,d),d}function Ku(s,c,u){if(c&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Ca&&!s.pa?new ee(new jn({eb:u})):new ee(s.pa),c.Ha(s.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wu(){}n=Wu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Xr(){}Xr.prototype.g=function(s,c){return new Ae(s,c)};function Ae(s,c){fe.call(this),this.g=new Lu(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(s?s["X-WebChannel-Client-Profile"]=c.va:s={"X-WebChannel-Client-Profile":c.va}),this.g.S=s,(s=c&&c.Sb)&&!j(s)&&(this.g.m=s),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new Wt(this)}N(Ae,fe),Ae.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){Cs(this.g)},Ae.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var u={};u.__data__=s,s=u}else this.u&&(u={},u.__data__=gs(s),s=u);c.i.push(new sf(c.Ya++,s)),c.G==3&&Jr(c)},Ae.prototype.N=function(){this.g.l=null,delete this.j,Cs(this.g),delete this.g,Ae.aa.N.call(this)};function Hu(s){ys.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let u in c){s=u;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}N(Hu,ys);function Qu(){vs.call(this),this.status=1}N(Qu,vs);function Wt(s){this.g=s}N(Wt,Wu),Wt.prototype.ua=function(){ve(this.g,"a")},Wt.prototype.ta=function(s){ve(this.g,new Hu(s))},Wt.prototype.sa=function(s){ve(this.g,new Qu)},Wt.prototype.ra=function(){ve(this.g,"b")},Xr.prototype.createWebChannel=Xr.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,Ko=et.createWebChannelTransport=function(){return new Xr},Go=et.getStatEventTarget=function(){return Br()},zo=et.Event=Tt,Ei=et.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},qr.NO_ERROR=0,qr.TIMEOUT=8,qr.HTTP_ERROR=6,dr=et.ErrorCode=qr,hu.COMPLETE="complete",jo=et.EventType=hu,ou.EventType=Vn,Vn.OPEN="a",Vn.CLOSE="b",Vn.ERROR="c",Vn.MESSAGE="d",fe.prototype.listen=fe.prototype.K,on=et.WebChannel=ou,$o=et.FetchXmlHttpFactory=jn,ee.prototype.listenOnce=ee.prototype.L,ee.prototype.getLastError=ee.prototype.Ka,ee.prototype.getLastErrorCode=ee.prototype.Ba,ee.prototype.getStatus=ee.prototype.Z,ee.prototype.getResponseJson=ee.prototype.Oa,ee.prototype.getResponseText=ee.prototype.oa,ee.prototype.send=ee.prototype.ea,ee.prototype.setWithCredentials=ee.prototype.Ha,qo=et.XhrIo=ee}).apply(typeof wi<"u"?wi:typeof self<"u"?self:typeof window<"u"?window:{});var oh="@firebase/firestore";var ue=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ue.UNAUTHENTICATED=new ue(null),ue.GOOGLE_CREDENTIALS=new ue("google-credentials-uid"),ue.FIRST_PARTY=new ue("first-party-uid"),ue.MOCK_USER=new ue("mock-user");var Sn="10.12.0";var Ft=new pt("@firebase/firestore");function fr(){return Ft.logLevel}function O(n,...e){if(Ft.logLevel<=B.DEBUG){let t=e.map(kc);Ft.debug(`Firestore (${Sn}): ${n}`,...t)}}function tt(n,...e){if(Ft.logLevel<=B.ERROR){let t=e.map(kc);Ft.error(`Firestore (${Sn}): ${n}`,...t)}}function dn(n,...e){if(Ft.logLevel<=B.WARN){let t=e.map(kc);Ft.warn(`Firestore (${Sn}): ${n}`,...t)}}function kc(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function M(n="Unexpected state"){let e=`FIRESTORE (${Sn}) INTERNAL ASSERTION FAILED: `+n;throw tt(e),new Error(e)}function Y(n,e){n||M()}function F(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends Ce{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ue=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ri=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Yo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ue.UNAUTHENTICATED))}shutdown(){}},Xo=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Zo=class{constructor(e){this.t=e,this.currentUser=ue.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new Ue;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ue,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>b(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},l=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ue)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string"),new Ri(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string"),new ue(e)}},ea=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ue.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ta=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ea(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}},na=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ra=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.R;return this.R=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?i(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string"),this.R=t.token,new na(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Ug(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Ci=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=Ug(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%e.length))}return r}};function H(n,e){return n<e?-1:n>e?1:0}function fn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var he=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var U=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new he(0,0))}static max(){return new n(new he(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Pi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(),r===void 0?r=e.length-t:r>e.length-t&&M(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=e.get(i),a=t.get(i);if(o<a)return-1;if(o>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends Pi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},Bg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Re=class n extends Pi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return Bg.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new V(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let l=e[i];if(l==="\\"){if(i+1===e.length)throw new V(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(o(),i++)}if(o(),a)throw new V(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var ia=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};ia.UNKNOWN_ID=-1;function qg(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=U.fromTimestamp(r===1e9?new he(t+1,0):new he(t,r));return new Ut(i,L.empty(),e)}function $g(n){return new Ut(n.readTime,n.key,-1)}var Ut=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(U.min(),L.empty(),-1)}static max(){return new n(U.max(),L.empty(),-1)}};function jg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:H(n.largestBatchId,e.largestBatchId))}var zg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",sa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Nr(n){return b(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==zg)throw n;O("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;t(e[f]).next(m=>{a[f]=m,++l,l===o&&r(a)},m=>i(m))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function Gg(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Or(n){return n.name==="IndexedDbTransactionError"}var Oh=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function ts(n){return n==null}function vr(n){return n===0&&1/n==-1/0}function Kg(n){return typeof n=="number"&&Number.isInteger(n)&&!vr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Wg=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],dw=[...Wg,"documentOverlays"],Hg=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Qg=Hg,fw=[...Qg,"indexConfiguration","indexState","indexEntries"];function ah(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Rn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function xh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ne=class n{constructor(e,t){this.comparator=e,this.root=t||Be.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Be.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ln(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ln(this.root,e,this.comparator,!1)}getReverseIterator(){return new ln(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ln(this.root,e,this.comparator,!0)}},ln=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Be=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();let e=this.left.check();if(e!==this.right.check())throw M();return e+(this.isRed()?0:1)}};Be.EMPTY=null,Be.RED=!0,Be.BLACK=!1;Be.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(e,t,r,i,o){return this}insert(e,t,r){return new Be(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var _e=class n{constructor(e){this.comparator=e,this.data=new ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Di(this.data.getIterator())}getIteratorFrom(e){return new Di(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Di=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Fe=class n{constructor(e){this.fields=e,e.sort(Re.comparator)}static empty(){return new n([])}unionWith(e){let t=new _e(Re.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ki=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ee=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ki("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ee.EMPTY_BYTE_STRING=new Ee("");var Jg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nt(n){if(Y(!!n),typeof n=="string"){let e=0,t=Jg.exec(n);if(Y(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:te(n.seconds),nanos:te(n.nanos)}}function te(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function It(n){return typeof n=="string"?Ee.fromBase64String(n):Ee.fromUint8Array(n)}function Nc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Oc(n){let e=n.mapValue.fields.__previous_value__;return Nc(e)?Oc(e):e}function Ir(n){let e=nt(n.mapValue.fields.__local_write_time__.timestampValue);return new he(e.seconds,e.nanos)}var oa=class{constructor(e,t,r,i,o,a,l,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f}},Ni=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Ti={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Nc(n)?4:Vh(n)?9007199254740991:10:M()}function je(n,e){if(n===e)return!0;let t=Bt(n);if(t!==Bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ir(n).isEqual(Ir(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=nt(i.timestampValue),l=nt(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return It(i.bytesValue).isEqual(It(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return te(i.geoPointValue.latitude)===te(o.geoPointValue.latitude)&&te(i.geoPointValue.longitude)===te(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return te(i.integerValue)===te(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=te(i.doubleValue),l=te(o.doubleValue);return a===l?vr(a)===vr(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return fn(n.arrayValue.values||[],e.arrayValue.values||[],je);case 10:return function(i,o){let a=i.mapValue.fields||{},l=o.mapValue.fields||{};if(ah(a)!==ah(l))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!je(a[h],l[h])))return!1;return!0}(n,e);default:return M()}}function wr(n,e){return(n.values||[]).find(t=>je(t,e))!==void 0}function pn(n,e){if(n===e)return 0;let t=Bt(n),r=Bt(e);if(t!==r)return H(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,e.booleanValue);case 2:return function(o,a){let l=te(o.integerValue||o.doubleValue),h=te(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,e);case 3:return ch(n.timestampValue,e.timestampValue);case 4:return ch(Ir(n),Ir(e));case 5:return H(n.stringValue,e.stringValue);case 6:return function(o,a){let l=It(o),h=It(a);return l.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){let l=o.split("/"),h=a.split("/");for(let f=0;f<l.length&&f<h.length;f++){let m=H(l[f],h[f]);if(m!==0)return m}return H(l.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){let l=H(te(o.latitude),te(a.latitude));return l!==0?l:H(te(o.longitude),te(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(o,a){let l=o.values||[],h=a.values||[];for(let f=0;f<l.length&&f<h.length;++f){let m=pn(l[f],h[f]);if(m)return m}return H(l.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(o,a){if(o===Ti.mapValue&&a===Ti.mapValue)return 0;if(o===Ti.mapValue)return 1;if(a===Ti.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let T=0;T<h.length&&T<m.length;++T){let S=H(h[T],m[T]);if(S!==0)return S;let R=pn(l[h[T]],f[m[T]]);if(R!==0)return R}return H(h.length,m.length)}(n.mapValue,e.mapValue);default:throw M()}}function ch(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return H(n,e);let t=nt(n),r=nt(e),i=H(t.seconds,r.seconds);return i!==0?i:H(t.nanos,r.nanos)}function mn(n){return aa(n)}function aa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=nt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return It(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return L.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=aa(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${aa(t.fields[a])}`;return i+"}"}(n.mapValue):M()}function ca(n){return!!n&&"integerValue"in n}function xc(n){return!!n&&"arrayValue"in n}function uh(n){return!!n&&"nullValue"in n}function lh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function bi(n){return!!n&&"mapValue"in n}function mr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Rn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=mr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Vh(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Oe=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!bi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mr(t)}setAll(e){let t=Re.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=mr(a):i.push(l.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());bi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return je(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];bi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Rn(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(mr(this.value))}};function Lh(n){let e=[];return Rn(n.fields,(t,r)=>{let i=new Re([t]);if(bi(r)){let o=Lh(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Fe(e)}var xe=class n{constructor(e,t,r,i,o,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new n(e,0,U.min(),U.min(),U.min(),Oe.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,U.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,U.min(),U.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,U.min(),U.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var gn=class{constructor(e,t){this.position=e,this.inclusive=t}};function hh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=pn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function dh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!je(n.position[t],e.position[t]))return!1;return!0}var _n=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Yg(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Oi=class{},ae=class n extends Oi{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new la(e,t,r):t==="array-contains"?new fa(e,r):t==="in"?new pa(e,r):t==="not-in"?new ma(e,r):t==="array-contains-any"?new ga(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ha(e,r):new da(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(pn(t,this.value)):t!==null&&Bt(this.value)===Bt(t)&&this.matchesComparison(pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ze=class n extends Oi{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Mh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Mh(n){return n.op==="and"}function Fh(n){return Xg(n)&&Mh(n)}function Xg(n){for(let e of n.filters)if(e instanceof ze)return!1;return!0}function ua(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+mn(n.value);if(Fh(n))return n.filters.map(e=>ua(e)).join(",");{let e=n.filters.map(t=>ua(t)).join(",");return`${n.op}(${e})`}}function Uh(n,e){return n instanceof ae?function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&je(r.value,i.value)}(n,e):n instanceof ze?function(r,i){return i instanceof ze&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,l)=>o&&Uh(a,i.filters[l]),!0):!1}(n,e):void M()}function Bh(n){return n instanceof ae?function(t){return`${t.field.canonicalString()} ${t.op} ${mn(t.value)}`}(n):n instanceof ze?function(t){return t.op.toString()+" {"+t.getFilters().map(Bh).join(" ,")+"}"}(n):"Filter"}var la=class extends ae{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},ha=class extends ae{constructor(e,t){super(e,"in",t),this.keys=qh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},da=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=qh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function qh(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var fa=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return xc(t)&&wr(t.arrayValue,this.value)}},pa=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&wr(this.value.arrayValue,t)}},ma=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(wr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!wr(this.value.arrayValue,t)}},ga=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!xc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>wr(this.value.arrayValue,r))}};var _a=class{constructor(e,t=null,r=[],i=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=l,this.ue=null}};function fh(n,e=null,t=[],r=[],i=null,o=null,a=null){return new _a(n,e,t,r,i,o,a)}function Vc(n){let e=F(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ua(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ts(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>mn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>mn(r)).join(",")),e.ue=t}return e.ue}function Lc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Yg(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Uh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!dh(n.startAt,e.startAt)&&dh(n.endAt,e.endAt)}function ya(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var yn=class{constructor(e,t=null,r=[],i=[],o=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Zg(n,e,t,r,i,o,a,l){return new yn(n,e,t,r,i,o,a,l)}function Mc(n){return new yn(n)}function ph(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function e_(n){return n.collectionGroup!==null}function gr(n){let e=F(n);if(e.ce===null){e.ce=[];let t=new Set;for(let o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new _e(Re.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new _n(o,r))}),t.has(Re.keyField().canonicalString())||e.ce.push(new _n(Re.keyField(),r))}return e.ce}function qe(n){let e=F(n);return e.le||(e.le=t_(e,gr(n))),e.le}function t_(n,e){if(n.limitType==="F")return fh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new _n(i.field,o)});let t=n.endAt?new gn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new gn(n.startAt.position,n.startAt.inclusive):null;return fh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function va(n,e,t){return new yn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ns(n,e){return Lc(qe(n),qe(e))&&n.limitType===e.limitType}function $h(n){return`${Vc(qe(n))}|lt:${n.limitType}`}function an(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Bh(i)).join(", ")}]`),ts(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>mn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>mn(i)).join(",")),`Target(${r})`}(qe(n))}; limitType=${n.limitType})`}function rs(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of gr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,l,h){let f=hh(a,l,h);return a.inclusive?f<=0:f<0}(r.startAt,gr(r),i)||r.endAt&&!function(a,l,h){let f=hh(a,l,h);return a.inclusive?f>=0:f>0}(r.endAt,gr(r),i))}(n,e)}function n_(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function jh(n){return(e,t)=>{let r=!1;for(let i of gr(n)){let o=r_(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function r_(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):function(o,a,l){let h=a.data.field(o),f=l.data.field(o);return h!==null&&f!==null?pn(h,f):M()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M()}}var wt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Rn(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return xh(this.inner)}size(){return this.innerSize}};var i_=new ne(L.comparator);function rt(){return i_}var zh=new ne(L.comparator);function pr(...n){let e=zh;for(let t of n)e=e.insert(t.key,t);return e}function Gh(n){let e=zh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Lt(){return _r()}function Kh(){return _r()}function _r(){return new wt(n=>n.toString(),(n,e)=>n.isEqual(e))}var s_=new ne(L.comparator),o_=new _e(L.comparator);function q(...n){let e=o_;for(let t of n)e=e.add(t);return e}var a_=new _e(H);function c_(){return a_}function Wh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vr(e)?"-0":e}}function Hh(n){return{integerValue:""+n}}function u_(n,e){return Kg(e)?Hh(e):Wh(n,e)}var vn=class{constructor(){this._=void 0}};function l_(n,e,t){return n instanceof In?function(i,o){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Nc(o)&&(o=Oc(o)),o&&(a.fields.__previous_value__=o),{mapValue:a}}(t,e):n instanceof qt?Jh(n,e):n instanceof $t?Yh(n,e):function(i,o){let a=Qh(i,o),l=mh(a)+mh(i.Pe);return ca(a)&&ca(i.Pe)?Hh(l):Wh(i.serializer,l)}(n,e)}function h_(n,e,t){return n instanceof qt?Jh(n,e):n instanceof $t?Yh(n,e):t}function Qh(n,e){return n instanceof wn?function(r){return ca(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var In=class extends vn{},qt=class extends vn{constructor(e){super(),this.elements=e}};function Jh(n,e){let t=Xh(e);for(let r of n.elements)t.some(i=>je(i,r))||t.push(r);return{arrayValue:{values:t}}}var $t=class extends vn{constructor(e){super(),this.elements=e}};function Yh(n,e){let t=Xh(e);for(let r of n.elements)t=t.filter(i=>!je(i,r));return{arrayValue:{values:t}}}var wn=class extends vn{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function mh(n){return te(n.integerValue||n.doubleValue)}function Xh(n){return xc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function d_(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof qt&&i instanceof qt||r instanceof $t&&i instanceof $t?fn(r.elements,i.elements,je):r instanceof wn&&i instanceof wn?je(r.Pe,i.Pe):r instanceof In&&i instanceof In}(n.transform,e.transform)}var Ia=class{constructor(e,t){this.version=e,this.transformResults=t}},vt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Si(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var En=class{};function Zh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Er(n.key,vt.none()):new jt(n.key,n.data,vt.none());{let t=n.data,r=Oe.empty(),i=new _e(Re.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new it(n.key,r,new Fe(i.toArray()),vt.none())}}function f_(n,e,t){n instanceof jt?function(i,o,a){let l=i.value.clone(),h=_h(i.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof it?function(i,o,a){if(!Si(i.precondition,o))return void o.convertToUnknownDocument(a.version);let l=_h(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(ed(i)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function yr(n,e,t,r){return n instanceof jt?function(o,a,l,h){if(!Si(o.precondition,a))return l;let f=o.value.clone(),m=yh(o.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof it?function(o,a,l,h){if(!Si(o.precondition,a))return l;let f=yh(o.fieldTransforms,h,a),m=a.data;return m.setAll(ed(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(T=>T.field))}(n,e,t,r):function(o,a,l){return Si(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function p_(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=Qh(r.transform,i||null);o!=null&&(t===null&&(t=Oe.empty()),t.set(r.field,o))}return t||null}function gh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&fn(r,i,(o,a)=>d_(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var jt=class extends En{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},it=class extends En{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function ed(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function _h(n,e,t){let r=new Map;Y(n.length===t.length);for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,l=e.data.field(o.field);r.set(o.field,h_(a,l,t[i]))}return r}function yh(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,l_(o,a,e))}return r}var Er=class extends En{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},wa=class extends En{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ea=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&f_(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=yr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=yr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Kh();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,l=this.applyToLocalView(a,o.mutatedFields);l=t.has(i.key)?null:l;let h=Zh(a,l);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(U.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),q())}isEqual(e){return this.batchId===e.batchId&&fn(this.mutations,e.mutations,(t,r)=>gh(t,r))&&fn(this.baseMutations,e.baseMutations,(t,r)=>gh(t,r))}},Ta=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Y(e.mutations.length===r.length);let i=function(){return s_}(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var Aa=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ba=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var re,G;function m_(n){switch(n){default:return M();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function td(n){if(n===void 0)return tt("GRPC error has no .code"),C.UNKNOWN;switch(n){case re.OK:return C.OK;case re.CANCELLED:return C.CANCELLED;case re.UNKNOWN:return C.UNKNOWN;case re.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case re.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case re.INTERNAL:return C.INTERNAL;case re.UNAVAILABLE:return C.UNAVAILABLE;case re.UNAUTHENTICATED:return C.UNAUTHENTICATED;case re.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case re.NOT_FOUND:return C.NOT_FOUND;case re.ALREADY_EXISTS:return C.ALREADY_EXISTS;case re.PERMISSION_DENIED:return C.PERMISSION_DENIED;case re.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case re.ABORTED:return C.ABORTED;case re.OUT_OF_RANGE:return C.OUT_OF_RANGE;case re.UNIMPLEMENTED:return C.UNIMPLEMENTED;case re.DATA_LOSS:return C.DATA_LOSS;default:return M()}}(G=re||(re={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";var vh=null;function g_(){return new TextEncoder}var __=new yt([4294967295,4294967295],0);function Ih(n){let e=g_().encode(n),t=new Bo;return t.update(e),new Uint8Array(t.digest())}function wh(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new yt([t,r],0),new yt([i,o],0)]}var Sa=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Mt(`Invalid padding: ${t}`);if(r<0)throw new Mt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Mt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Mt(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=yt.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(yt.fromNumber(r)));return i.compare(__)===1&&(i=new yt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ih(e),[r,i]=wh(t);for(let o=0;o<this.hashCount;o++){let a=this.Ee(r,i,o);if(!this.de(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Ie===0)return;let t=Ih(e),[r,i]=wh(t);for(let o=0;o<this.hashCount;o++){let a=this.Ee(r,i,o);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Mt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var xi=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Tr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(U.min(),i,new ne(H),rt(),q())}},Tr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,q(),q(),q())}};var hn=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Vi=class{constructor(e,t){this.targetId=e,this.me=t}},Li=class{constructor(e,t,r=Ee.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Mi=class{constructor(){this.fe=0,this.ge=Th(),this.pe=Ee.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=q(),t=q(),r=q();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M()}}),new Tr(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=Th()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Y(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Ra=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=rt(),this.qe=Eh(),this.Qe=new ne(H)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:M()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let o=i.target;if(ya(o))if(r===0){let a=new L(o.path);this.Ue(t,a,xe.newNoDocument(a,U.min()))}else Y(r===1);else{let a=this.Ye(t);if(a!==r){let l=this.Ze(e),h=l?this.Xe(l,e,a):1;if(h!==0){this.je(t);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,f)}vh?.et(function(m,T,S,R,N){var x,k,$,j,z,X;let ye={localCacheCount:m,existenceFilterCount:T.count,databaseId:S.database,projectId:S.projectId},Q=T.unchangedNames;return Q&&(ye.bloomFilter={applied:N===0,hashCount:(x=Q?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(j=($=(k=Q?.bits)===null||k===void 0?void 0:k.bitmap)===null||$===void 0?void 0:$.length)!==null&&j!==void 0?j:0,padding:(X=(z=Q?.bits)===null||z===void 0?void 0:z.padding)!==null&&X!==void 0?X:0,mightContain:v=>{var p;return(p=R?.mightContain(v))!==null&&p!==void 0&&p}}),ye}(a,e.me,this.Le.tt(),l,h))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,l;try{a=It(r).toUint8Array()}catch(h){if(h instanceof ki)return dn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Sa(a,i,o)}catch(h){return dn(h instanceof Mt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.Ie===0?null:l}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Le.tt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,o,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((o,a)=>{let l=this.Je(a);if(l){if(o.current&&ya(l.target)){let h=new L(l.target.path);this.ke.get(h)!==null||this.it(a,h)||this.Ue(a,h,xe.newNoDocument(h,e))}o.be&&(t.set(a,o.Ce()),o.ve())}});let r=q();this.qe.forEach((o,a)=>{let l=!0;a.forEachWhile(h=>{let f=this.Je(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.ke.forEach((o,a)=>a.setReadTime(e));let i=new xi(e,t,this.Qe,this.ke,r);return this.ke=rt(),this.qe=Eh(),this.Qe=new ne(H),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Mi,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new _e(H),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Mi),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Eh(){return new ne(L.comparator)}function Th(){return new ne(L.comparator)}var y_={asc:"ASCENDING",desc:"DESCENDING"},v_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},I_={and:"AND",or:"OR"},Ca=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Pa(n,e){return n.useProto3Json||ts(e)?e:{value:e}}function Fi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function nd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function w_(n,e){return Fi(n,e.toTimestamp())}function $e(n){return Y(!!n),U.fromTimestamp(function(t){let r=nt(t);return new he(r.seconds,r.nanos)}(n))}function Fc(n,e){return Da(n,e).canonicalString()}function Da(n,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function rd(n){let e=se.fromString(n);return Y(cd(e)),e}function ka(n,e){return Fc(n.databaseId,e.path)}function Wo(n,e){let t=rd(e);if(t.get(1)!==n.databaseId.projectId)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(sd(t))}function id(n,e){return Fc(n.databaseId,e)}function E_(n){let e=rd(n);return e.length===4?se.emptyPath():sd(e)}function Na(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function sd(n){return Y(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Ah(n,e,t){return{name:ka(n,e),fields:t.value.mapValue.fields}}function T_(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:M()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(Y(m===void 0||typeof m=="string"),Ee.fromBase64String(m||"")):(Y(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Ee.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(f){let m=f.code===void 0?C.UNKNOWN:td(f.code);return new V(m,f.message||"")}(a);t=new Li(r,i,o,l||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Wo(n,r.document.name),o=$e(r.document.updateTime),a=r.document.createTime?$e(r.document.createTime):U.min(),l=new Oe({mapValue:{fields:r.document.fields}}),h=xe.newFoundDocument(i,o,a,l),f=r.targetIds||[],m=r.removedTargetIds||[];t=new hn(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Wo(n,r.document),o=r.readTime?$e(r.readTime):U.min(),a=xe.newNoDocument(i,o),l=r.removedTargetIds||[];t=new hn([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Wo(n,r.document),o=r.removedTargetIds||[];t=new hn([],o,i,null)}else{if(!("filter"in e))return M();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new ba(i,o),l=r.targetId;t=new Vi(l,a)}}return t}function A_(n,e){let t;if(e instanceof jt)t={update:Ah(n,e.key,e.value)};else if(e instanceof Er)t={delete:ka(n,e.key)};else if(e instanceof it)t={update:Ah(n,e.key,e.data),updateMask:O_(e.fieldMask)};else{if(!(e instanceof wa))return M();t={verify:ka(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){let l=a.transform;if(l instanceof In)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof qt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof $t)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof wn)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw M()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:w_(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:M()}(n,e.precondition)),t}function b_(n,e){return n&&n.length>0?(Y(e!==void 0),n.map(t=>function(i,o){let a=i.updateTime?$e(i.updateTime):$e(o);return a.isEqual(U.min())&&(a=$e(o)),new Ia(a,i.transformResults||[])}(t,e))):[]}function S_(n,e){return{documents:[id(n,e.path)]}}function R_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=id(n,i);let o=function(f){if(f.length!==0)return ad(ze.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let a=function(f){if(f.length!==0)return f.map(m=>function(S){return{field:cn(S.field),direction:D_(S.dir)}}(m))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let l=Pa(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{_t:t,parent:i}}function C_(n){let e=E_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Y(r===1);let m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let o=[];t.where&&(o=function(T){let S=od(T);return S instanceof ze&&Fh(S)?S.getFilters():[S]}(t.where));let a=[];t.orderBy&&(a=function(T){return T.map(S=>function(N){return new _n(un(N.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(S))}(t.orderBy));let l=null;t.limit&&(l=function(T){let S;return S=typeof T=="object"?T.value:T,ts(S)?null:S}(t.limit));let h=null;t.startAt&&(h=function(T){let S=!!T.before,R=T.values||[];return new gn(R,S)}(t.startAt));let f=null;return t.endAt&&(f=function(T){let S=!T.before,R=T.values||[];return new gn(R,S)}(t.endAt)),Zg(e,i,a,o,l,"F",h,f)}function P_(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function od(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=un(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=un(t.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=un(t.unaryFilter.field);return ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=un(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(n):n.fieldFilter!==void 0?function(t){return ae.create(un(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ze.create(t.compositeFilter.filters.map(r=>od(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M()}}(t.compositeFilter.op))}(n):M()}function D_(n){return y_[n]}function k_(n){return v_[n]}function N_(n){return I_[n]}function cn(n){return{fieldPath:n.canonicalString()}}function un(n){return Re.fromServerFormat(n.fieldPath)}function ad(n){return n instanceof ae?function(t){if(t.op==="=="){if(lh(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NAN"}};if(uh(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(lh(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NOT_NAN"}};if(uh(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cn(t.field),op:k_(t.op),value:t.value}}}(n):n instanceof ze?function(t){let r=t.getFilters().map(i=>ad(i));return r.length===1?r[0]:{compositeFilter:{op:N_(t.op),filters:r}}}(n):M()}function O_(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function cd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ar=class n{constructor(e,t,r,i,o=U.min(),a=U.min(),l=Ee.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Oa=class{constructor(e){this.ct=e}};function x_(n){let e=C_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?va(e,e.limit,"L"):e}var Ui=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(te(e.integerValue));else if("doubleValue"in e){let r=te(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),vr(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"&&(r=nt(r)),t.At(`${r.seconds||""}`),t.dt(r.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(It(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Vh(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):M()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),L.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};Ui.bt=new Ui;var xa=class{constructor(){this._n=new Va}addToCollectionParentIndex(e,t){return this._n.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ut.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ut.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},Va=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new _e(se.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new _e(se.comparator)).toArray()}};var mw=new Uint8Array(0);var Me=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Me.DEFAULT_COLLECTION_PERCENTILE=10,Me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Me.DEFAULT=new Me(41943040,Me.DEFAULT_COLLECTION_PERCENTILE,Me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Me.DISABLED=new Me(-1,0,0);var br=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var La=class{constructor(){this.changes=new wt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ma=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Fa=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&yr(r.mutation,i,Fe.empty(),he.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=q()){let i=Lt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=pr();return o.forEach((l,h)=>{a=a.insert(l,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Lt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,q()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let o=rt(),a=_r(),l=function(){return _r()}();return t.forEach((h,f)=>{let m=r.get(f.key);i.has(f.key)&&(m===void 0||m.mutation instanceof it)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),yr(m.mutation,f,m.mutation.getFieldMask(),he.now())):a.set(f.key,Fe.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((f,m)=>a.set(f,m)),t.forEach((f,m)=>{var T;return l.set(f,new Ma(m,(T=a.get(f))!==null&&T!==void 0?T:null))}),l))}recalculateAndSaveOverlays(e,t){let r=_r(),i=new ne((a,l)=>a-l),o=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let l of a)l.keys().forEach(h=>{let f=t.get(h);if(f===null)return;let m=r.get(h)||Fe.empty();m=l.applyToLocalView(f,m),r.set(h,m);let T=(i.get(l.batchId)||q()).add(h);i=i.insert(l.batchId,T)})}).next(()=>{let a=[],l=i.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,m=h.value,T=Kh();m.forEach(S=>{if(!o.has(S)){let R=Zh(t.get(S),r.get(S));R!==null&&T.set(S,R),o=o.add(S)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,T))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):e_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):P.resolve(Lt()),l=-1,h=o;return a.next(f=>P.forEach(f,(m,T)=>(l<T.largestBatchId&&(l=T.largestBatchId),o.get(m)?P.resolve():this.remoteDocumentCache.getEntry(e,m).next(S=>{h=h.insert(m,S)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,h,f,q())).next(m=>({batchId:l,changes:Gh(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=pr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=pr();return this.indexManager.getCollectionParents(e,o).next(l=>P.forEach(l,h=>{let f=function(T,S){return new yn(S,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(m=>{m.forEach((T,S)=>{a=a.insert(T,S)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,f)=>{let m=f.getKey();a.get(m)===null&&(a=a.insert(m,xe.newInvalidDocument(m)))});let l=pr();return a.forEach((h,f)=>{let m=o.get(h);m!==void 0&&yr(m.mutation,f,Fe.empty(),he.now()),rs(t,f)&&(l=l.insert(h,f))}),l})}};var Ua=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return P.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:$e(i.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:x_(i.bundledQuery),readTime:$e(i.readTime)}}(t)),P.resolve()}};var Ba=class{constructor(){this.overlays=new ne(L.comparator),this.hr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Lt();return P.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.ht(e,t,o)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.hr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=Lt(),o=t.length+1,a=new L(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ne((f,m)=>f-m),a=this.overlays.getIterator();for(;a.hasNext();){let f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=Lt(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}let l=Lt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>l.set(f,m)),!(l.size()>=i)););return P.resolve(l)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Aa(t,r));let o=this.hr.get(t);o===void 0&&(o=q(),this.hr.set(t,o)),this.hr.set(t,o.add(r.key))}};var Sr=class{constructor(){this.Pr=new _e(ie.Ir),this.Tr=new _e(ie.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new ie(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new ie(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new L(new se([])),r=new ie(t,e),i=new ie(t,e+1),o=[];return this.Tr.forEachInRange([r,i],a=>{this.Ar(a),o.push(a.key)}),o}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new L(new se([])),r=new ie(t,e),i=new ie(t,e+1),o=q();return this.Tr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new ie(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ie=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return L.comparator(e.key,t.key)||H(e.pr,t.pr)}static Er(e,t){return H(e.pr,t.pr)||L.comparator(e.key,t.key)}};var qa=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new _e(ie.Ir)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ea(o,t,r,i);this.mutationQueue.push(a);for(let l of i)this.wr=this.wr.add(new ie(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ie(t,0),i=new ie(t,Number.POSITIVE_INFINITY),o=[];return this.wr.forEachInRange([r,i],a=>{let l=this.Sr(a.pr);o.push(l)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new _e(H);return t.forEach(i=>{let o=new ie(i,0),a=new ie(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([o,a],l=>{r=r.add(l.pr)})}),P.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;L.isDocumentKey(o)||(o=o.child(""));let a=new ie(new L(o),0),l=new _e(H);return this.wr.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(l=l.add(h.pr)),!0)},a),P.resolve(this.Dr(l))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Y(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return P.forEach(t.mutations,i=>{let o=new ie(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new ie(t,0),i=this.wr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var $a=class{constructor(e){this.vr=e,this.docs=function(){return new ne(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let r=rt();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():xe.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=rt(),a=t.path,l=new L(a.child("")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||jg($g(m),r)<=0||(i.has(m.key)||rs(t,m))&&(o=o.insert(m.key,m.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,i){M()}Fr(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ja(this)}getSize(e){return P.resolve(this.size)}},ja=class extends La{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var za=class{constructor(e){this.persistence=e,this.Mr=new wt(t=>Vc(t),Lc),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Sr,this.targetCount=0,this.Lr=br.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),P.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new br(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.qn(t),P.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.Mr.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Mr.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.Nr.containsKey(t))}};var Ga=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new Oh(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new za(this),this.indexManager=new xa,this.remoteDocumentCache=function(i){return new $a(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Oa(t),this.$r=new Ua(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ba,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new qa(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new Ka(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(o=>this.referenceDelegate.Wr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Gr(e,t){return P.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},Ka=class extends sa{constructor(e){super(),this.currentSequenceNumber=e}},Wa=class n{constructor(e){this.persistence=e,this.zr=new Sr,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw M()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),P.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.Jr.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Jr,r=>{let i=L.fromPath(r);return this.Yr(e,i).next(o=>{o||t.removeEntry(i,U.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return P.or([()=>P.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var Ha=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=q(),i=q();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var Qa=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Ja=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Tl()?8:Gg(Se())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ji(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.Hi(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new Qa;return this.Ji(e,t,a).next(l=>{if(o.result=l,this.Ui)return this.Yi(e,t,a,l.size)})}).next(()=>o.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(fr()<=B.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",an(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),P.resolve()):(fr()<=B.DEBUG&&O("QueryEngine","Query:",an(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(fr()<=B.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",an(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qe(t))):P.resolve())}ji(e,t){if(ph(t))return P.resolve(null);let r=qe(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=va(t,null,"F"),r=qe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=q(...o);return this.zi.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(h=>{let f=this.Zi(t,l);return this.Xi(t,f,a,h.readTime)?this.ji(e,va(t,null,"F")):this.es(e,f,t,h)}))})))}Hi(e,t,r,i){return ph(t)||i.isEqual(U.min())?P.resolve(null):this.zi.getDocuments(e,r).next(o=>{let a=this.Zi(t,o);return this.Xi(t,a,r,i)?P.resolve(null):(fr()<=B.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),an(t)),this.es(e,a,t,qg(i,-1)).next(l=>l))})}Zi(e,t){let r=new _e(jh(e));return t.forEach((i,o)=>{rs(e,o)&&(r=r.add(o))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ji(e,t,r){return fr()<=B.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",an(t)),this.zi.getDocumentsMatchingQuery(e,t,Ut.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Ya=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ne(H),this.rs=new wt(o=>Vc(o),Lc),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Fa(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function V_(n,e,t,r){return new Ya(n,e,t,r)}function ud(n,e){return b(this,null,function*(){let t=F(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],l=[],h=q();for(let f of i){a.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}for(let f of o){l.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(r,h).next(f=>({us:f,removedBatchIds:a,addedBatchIds:l}))})})})}function L_(n,e){let t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.os.newChangeBuffer({trackRemovals:!0});return function(l,h,f,m){let T=f.batch,S=T.keys(),R=P.resolve();return S.forEach(N=>{R=R.next(()=>m.getEntry(h,N)).next(x=>{let k=f.docVersions.get(N);Y(k!==null),x.version.compareTo(k)<0&&(T.applyToRemoteDocument(x,f),x.isValidDocument()&&(x.setReadTime(f.commitVersion),m.addEntry(x)))})}),R.next(()=>l.mutationQueue.removeMutationBatch(h,T))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=q();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function ld(n){let e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function M_(n,e){let t=F(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let l=[];e.targetChanges.forEach((m,T)=>{let S=i.get(T);if(!S)return;l.push(t.Qr.removeMatchingKeys(o,m.removedDocuments,T).next(()=>t.Qr.addMatchingKeys(o,m.addedDocuments,T)));let R=S.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(T)!==null?R=R.withResumeToken(Ee.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):m.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(m.resumeToken,r)),i=i.insert(T,R),function(x,k,$){return x.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(S,R,m)&&l.push(t.Qr.updateTargetData(o,R))});let h=rt(),f=q();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,m))}),l.push(F_(o,a,e.documentUpdates).next(m=>{h=m.cs,f=m.ls})),!r.isEqual(U.min())){let m=t.Qr.getLastRemoteSnapshotVersion(o).next(T=>t.Qr.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(m)}return P.waitFor(l).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(t.ns=i,o))}function F_(n,e,t){let r=q(),i=q();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=rt();return t.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(l)),h.isNoDocument()&&h.version.isEqual(U.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):O("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{cs:a,ls:i}})}function U_(n,e){let t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function B_(n,e){let t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(o=>o?(i=o,P.resolve(i)):t.Qr.allocateTargetId(r).next(a=>(i=new Ar(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Xa(n,e,t){return b(this,null,function*(){let r=F(n),i=r.ns.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Or(a))throw a;O("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function bh(n,e,t){let r=F(n),i=U.min(),o=q();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,m){let T=F(h),S=T.rs.get(m);return S!==void 0?P.resolve(T.ns.get(S)):T.Qr.getTargetData(f,m)}(r,a,qe(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(a,l.targetId).next(h=>{o=h})}).next(()=>r.ts.getDocumentsMatchingQuery(a,e,t?i:U.min(),t?o:q())).next(l=>(q_(r,n_(e),l),{documents:l,hs:o})))}function q_(n,e,t){let r=n.ss.get(e)||U.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.ss.set(e,r)}var Bi=class{constructor(){this.activeTargetIds=c_()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Za=class{constructor(){this.no=new Bi,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Bi,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ec=class{io(e){}shutdown(){}};var qi=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){O("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){O("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ai=null;function Ho(){return Ai===null?Ai=function(){return 268435456+Math.round(2147483648*Math.random())}():Ai++,"0x"+Ai.toString(16)}var $_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var tc=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}};var ge="WebChannelConnection",nc=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.wo=r+"://"+t.host,this.So=`projects/${i}/databases/${o}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${o}`}get Do(){return!1}Co(t,r,i,o,a){let l=Ho(),h=this.vo(t,r.toUriEncodedString());O("RestConnection",`Sending RPC '${t}' ${l}:`,h,i);let f={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(f,o,a),this.Mo(t,h,f,i).then(m=>(O("RestConnection",`Received RPC '${t}' ${l}: `,m),m),m=>{throw dn("RestConnection",`RPC '${t}' ${l} failed with error: `,m,"url: ",h,"request:",i),m})}xo(t,r,i,o,a,l){return this.Co(t,r,i,o,a)}Fo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Sn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,a)=>t[a]=o),i&&i.headers.forEach((o,a)=>t[a]=o)}vo(t,r){let i=$_[t];return`${this.wo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,r,i){let o=Ho();return new Promise((a,l)=>{let h=new qo;h.setWithCredentials(!0),h.listenOnce(jo.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case dr.NO_ERROR:let m=h.getResponseJson();O(ge,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),a(m);break;case dr.TIMEOUT:O(ge,`RPC '${e}' ${o} timed out`),l(new V(C.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:let T=h.getStatus();if(O(ge,`RPC '${e}' ${o} failed with status:`,T,"response text:",h.getResponseText()),T>0){let S=h.getResponseJson();Array.isArray(S)&&(S=S[0]);let R=S?.error;if(R&&R.status&&R.message){let N=function(k){let $=k.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf($)>=0?$:C.UNKNOWN}(R.status);l(new V(N,R.message))}else l(new V(C.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new V(C.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{O(ge,`RPC '${e}' ${o} completed.`)}});let f=JSON.stringify(i);O(ge,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,r,15)})}Oo(e,t,r){let i=Ho(),o=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ko(),l=Go(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.xmlHttpFactory=new $o({})),this.Fo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let m=o.join("");O(ge,`Creating RPC '${e}' stream ${i}: ${m}`,h);let T=a.createWebChannel(m,h),S=!1,R=!1,N=new tc({lo:k=>{R?O(ge,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(S||(O(ge,`Opening RPC '${e}' stream ${i} transport.`),T.open(),S=!0),O(ge,`RPC '${e}' stream ${i} sending:`,k),T.send(k))},ho:()=>T.close()}),x=(k,$,j)=>{k.listen($,z=>{try{j(z)}catch(X){setTimeout(()=>{throw X},0)}})};return x(T,on.EventType.OPEN,()=>{R||(O(ge,`RPC '${e}' stream ${i} transport opened.`),N.mo())}),x(T,on.EventType.CLOSE,()=>{R||(R=!0,O(ge,`RPC '${e}' stream ${i} transport closed`),N.po())}),x(T,on.EventType.ERROR,k=>{R||(R=!0,dn(ge,`RPC '${e}' stream ${i} transport errored:`,k),N.po(new V(C.UNAVAILABLE,"The operation could not be completed")))}),x(T,on.EventType.MESSAGE,k=>{var $;if(!R){let j=k.data[0];Y(!!j);let z=j,X=z.error||(($=z[0])===null||$===void 0?void 0:$.error);if(X){O(ge,`RPC '${e}' stream ${i} received error:`,X);let ye=X.status,Q=function(_){let y=re[_];if(y!==void 0)return td(y)}(ye),v=X.message;Q===void 0&&(Q=C.INTERNAL,v="Unknown error status: "+ye+" with message "+X.message),R=!0,N.po(new V(Q,v)),T.close()}else O(ge,`RPC '${e}' stream ${i} received:`,j),N.yo(j)}}),x(l,zo.STAT_EVENT,k=>{k.stat===Ei.PROXY?O(ge,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===Ei.NOPROXY&&O(ge,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.fo()},0),N}};function Qo(){return typeof document<"u"?document:null}function is(n){return new Ca(n,!0)}var $i=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.oi=e,this.timerId=t,this.No=r,this.Lo=i,this.Bo=o,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),r=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var ji=class{constructor(e,t,r,i,o,a,l,h){this.oi=e,this.Go=r,this.zo=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new $i(e,t)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return b(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){return b(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){return b(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(tt(t.toString()),tt("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Ao(t)})}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.jo===t&&this.u_(r,i)},r=>{e(()=>{let i=new V(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.c_(i)})})}u_(e,t){let r=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{r(()=>this.listener.Po())}),this.stream.To(()=>{r(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{r(()=>this.c_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>b(this,null,function*(){this.state=0,this.start()}))}c_(e){return O("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(O("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},rc=class extends ji{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=T_(this.serializer,e),r=function(o){if(!("targetChange"in o))return U.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?$e(a.readTime):U.min()}(e);return this.listener.h_(t,r)}P_(e){let t={};t.database=Na(this.serializer),t.addTarget=function(o,a){let l,h=a.target;if(l=ya(h)?{documents:S_(o,h)}:{query:R_(o,h)._t},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=nd(o,a.resumeToken);let f=Pa(o,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(U.min())>0){l.readTime=Fi(o,a.snapshotVersion.toTimestamp());let f=Pa(o,a.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,e);let r=P_(this.serializer,e);r&&(t.labels=r),this.i_(t)}I_(e){let t={};t.database=Na(this.serializer),t.removeTarget=e,this.i_(t)}},ic=class extends ji{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(Y(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let t=b_(e.writeResults,e.commitTime),r=$e(e.commitTime);return this.listener.A_(r,t)}return Y(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=Na(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>A_(this.serializer,r))};this.i_(t)}};var sc=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,Da(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(C.UNKNOWN,o.toString())})}xo(e,t,r,i,o){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.xo(e,Da(t,r),i,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(C.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},oc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(tt(t),this.y_=!1):O("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var ac=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=o,this.O_.io(a=>{r.enqueueAndForget(()=>b(this,null,function*(){zt(this)&&(O("RemoteStore","Restarting streams for network reachability change."),yield function(h){return b(this,null,function*(){let f=F(h);f.M_.add(4),yield xr(f),f.N_.set("Unknown"),f.M_.delete(4),yield ss(f)})}(this))}))}),this.N_=new oc(r,i)}};function ss(n){return b(this,null,function*(){if(zt(n))for(let e of n.x_)yield e(!0)})}function xr(n){return b(this,null,function*(){for(let e of n.x_)yield e(!1)})}function hd(n,e){let t=F(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),$c(t)?qc(t):Cn(t).Xo()&&Bc(t,e))}function Uc(n,e){let t=F(n),r=Cn(t);t.F_.delete(e),r.Xo()&&dd(t,e),t.F_.size===0&&(r.Xo()?r.n_():zt(t)&&t.N_.set("Unknown"))}function Bc(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Cn(n).P_(e)}function dd(n,e){n.L_.xe(e),Cn(n).I_(e)}function qc(n){n.L_=new Ra({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Cn(n).start(),n.N_.w_()}function $c(n){return zt(n)&&!Cn(n).Zo()&&n.F_.size>0}function zt(n){return F(n).M_.size===0}function fd(n){n.L_=void 0}function j_(n){return b(this,null,function*(){n.N_.set("Online")})}function z_(n){return b(this,null,function*(){n.F_.forEach((e,t)=>{Bc(n,e)})})}function G_(n,e){return b(this,null,function*(){fd(n),$c(n)?(n.N_.D_(e),qc(n)):n.N_.set("Unknown")})}function K_(n,e,t){return b(this,null,function*(){if(n.N_.set("Online"),e instanceof Li&&e.state===2&&e.cause)try{yield function(i,o){return b(this,null,function*(){let a=o.cause;for(let l of o.targetIds)i.F_.has(l)&&(yield i.remoteSyncer.rejectListen(l,a),i.F_.delete(l),i.L_.removeTarget(l))})}(n,e)}catch(r){O("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield zi(n,r)}else if(e instanceof hn?n.L_.Ke(e):e instanceof Vi?n.L_.He(e):n.L_.We(e),!t.isEqual(U.min()))try{let r=yield ld(n.localStore);t.compareTo(r)>=0&&(yield function(o,a){let l=o.L_.rt(a);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let m=o.F_.get(f);m&&o.F_.set(f,m.withResumeToken(h.resumeToken,a))}}),l.targetMismatches.forEach((h,f)=>{let m=o.F_.get(h);if(!m)return;o.F_.set(h,m.withResumeToken(Ee.EMPTY_BYTE_STRING,m.snapshotVersion)),dd(o,h);let T=new Ar(m.target,h,f,m.sequenceNumber);Bc(o,T)}),o.remoteSyncer.applyRemoteEvent(l)}(n,t))}catch(r){O("RemoteStore","Failed to raise snapshot:",r),yield zi(n,r)}})}function zi(n,e,t){return b(this,null,function*(){if(!Or(e))throw e;n.M_.add(1),yield xr(n),n.N_.set("Offline"),t||(t=()=>ld(n.localStore)),n.asyncQueue.enqueueRetryable(()=>b(this,null,function*(){O("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield ss(n)}))})}function pd(n,e){return e().catch(t=>zi(n,t,e))}function os(n){return b(this,null,function*(){let e=F(n),t=Et(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;W_(e);)try{let i=yield U_(e.localStore,r);if(i===null){e.v_.length===0&&t.n_();break}r=i.batchId,H_(e,i)}catch(i){yield zi(e,i)}md(e)&&gd(e)})}function W_(n){return zt(n)&&n.v_.length<10}function H_(n,e){n.v_.push(e);let t=Et(n);t.Xo()&&t.E_&&t.d_(e.mutations)}function md(n){return zt(n)&&!Et(n).Zo()&&n.v_.length>0}function gd(n){Et(n).start()}function Q_(n){return b(this,null,function*(){Et(n).V_()})}function J_(n){return b(this,null,function*(){let e=Et(n);for(let t of n.v_)e.d_(t.mutations)})}function Y_(n,e,t){return b(this,null,function*(){let r=n.v_.shift(),i=Ta.from(r,e,t);yield pd(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield os(n)})}function X_(n,e){return b(this,null,function*(){e&&Et(n).E_&&(yield function(r,i){return b(this,null,function*(){if(function(a){return m_(a)&&a!==C.ABORTED}(i.code)){let o=r.v_.shift();Et(r).t_(),yield pd(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield os(r)}})}(n,e)),md(n)&&gd(n)})}function Sh(n,e){return b(this,null,function*(){let t=F(n);t.asyncQueue.verifyOperationInProgress(),O("RemoteStore","RemoteStore received new credentials");let r=zt(t);t.M_.add(3),yield xr(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield ss(t)})}function Z_(n,e){return b(this,null,function*(){let t=F(n);e?(t.M_.delete(2),yield ss(t)):e||(t.M_.add(2),yield xr(t),t.N_.set("Unknown"))})}function Cn(n){return n.B_||(n.B_=function(t,r,i){let o=F(t);return o.f_(),new rc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Po:j_.bind(null,n),To:z_.bind(null,n),Ao:G_.bind(null,n),h_:K_.bind(null,n)}),n.x_.push(e=>b(this,null,function*(){e?(n.B_.t_(),$c(n)?qc(n):n.N_.set("Unknown")):(yield n.B_.stop(),fd(n))}))),n.B_}function Et(n){return n.k_||(n.k_=function(t,r,i){let o=F(t);return o.f_(),new ic(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Po:()=>Promise.resolve(),To:Q_.bind(null,n),Ao:X_.bind(null,n),R_:J_.bind(null,n),A_:Y_.bind(null,n)}),n.x_.push(e=>b(this,null,function*(){e?(n.k_.t_(),yield os(n)):(yield n.k_.stop(),n.v_.length>0&&(O("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var cc=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Ue,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,l=new n(e,t,a,i,o);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function jc(n,e){if(tt("AsyncQueue",`${e}: ${n}`),Or(n))return new V(C.UNAVAILABLE,`${e}: ${n}`);throw n}var Gi=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=pr(),this.sortedSet=new ne(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Ki=class{constructor(){this.q_=new ne(L.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):M():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},Tn=class n{constructor(e,t,r,i,o,a,l,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new n(e,t,Gi.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ns(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var uc=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},lc=class{constructor(){this.queries=new wt(e=>$h(e),ns),this.onlineState="Unknown",this.z_=new Set}};function ey(n,e){return b(this,null,function*(){let t=F(n),r=3,i=e.query,o=t.queries.get(i);o?!o.W_()&&e.G_()&&(r=2):(o=new uc,r=e.G_()?0:1);try{switch(r){case 0:o.K_=yield t.onListen(i,!0);break;case 1:o.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let l=jc(a,`Initialization of query '${an(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,o),o.U_.push(e),e.j_(t.onlineState),o.K_&&e.H_(o.K_)&&zc(t)})}function ty(n,e){return b(this,null,function*(){let t=F(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.U_.indexOf(e);a>=0&&(o.U_.splice(a,1),o.U_.length===0?i=e.G_()?0:1:!o.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function ny(n,e){let t=F(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let l of a.U_)l.H_(i)&&(r=!0);a.K_=i}}r&&zc(t)}function ry(n,e,t){let r=F(n),i=r.queries.get(e);if(i)for(let o of i.U_)o.onError(t);r.queries.delete(e)}function zc(n){n.z_.forEach(e=>{e.next()})}var hc,Rh;(Rh=hc||(hc={})).J_="default",Rh.Cache="cache";var dc=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==hc.Cache}};var Wi=class{constructor(e){this.key=e}},Hi=class{constructor(e){this.key=e}},fc=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=q(),this.mutatedKeys=q(),this.Ia=jh(e),this.Ta=new Gi(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new Ki,i=t?t.Ta:this.Ta,o=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,T)=>{let S=i.get(m),R=rs(this.query,T)?T:null,N=!!S&&this.mutatedKeys.has(S.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),k=!1;S&&R?S.data.isEqual(R.data)?N!==x&&(r.track({type:3,doc:R}),k=!0):this.Ra(S,R)||(r.track({type:2,doc:R}),k=!0,(h&&this.Ia(R,h)>0||f&&this.Ia(R,f)<0)&&(l=!0)):!S&&R?(r.track({type:0,doc:R}),k=!0):S&&!R&&(r.track({type:1,doc:S}),k=!0,(h||f)&&(l=!0)),k&&(R?(a=a.add(R),o=x?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{Ta:a,Aa:r,Xi:l,mutatedKeys:o}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let a=e.Aa.Q_();a.sort((m,T)=>function(R,N){let x=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return x(R)-x(N)}(m.type,T.type)||this.Ia(m.doc,T.doc)),this.Va(r),i=i!=null&&i;let l=t&&!i?this.ma():[],h=this.Pa.size===0&&this.current&&!i?1:0,f=h!==this.ha;return this.ha=h,a.length!==0||f?{snapshot:new Tn(this.query,e.Ta,o,a,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:l}:{fa:l}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Ki,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=q(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new Hi(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new Wi(r))}),t}pa(e){this.la=e.hs,this.Pa=q();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Tn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},pc=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},mc=class{constructor(e){this.key=e,this.wa=!1}},gc=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new wt(l=>$h(l),ns),this.Da=new Map,this.Ca=new Set,this.va=new ne(L.comparator),this.Fa=new Map,this.Ma=new Sr,this.xa={},this.Oa=new Map,this.Na=br.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function iy(n,e,t=!0){return b(this,null,function*(){let r=Ed(n),i,o=r.ba.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.ya()):i=yield _d(r,e,t,!0),i})}function sy(n,e){return b(this,null,function*(){let t=Ed(n);yield _d(t,e,!0,!1)})}function _d(n,e,t,r){return b(this,null,function*(){let i=yield B_(n.localStore,qe(e)),o=i.targetId,a=t?n.sharedClientState.addLocalQueryTarget(o):"not-current",l;return r&&(l=yield oy(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&hd(n.remoteStore,i),l})}function oy(n,e,t,r,i){return b(this,null,function*(){n.Ba=(T,S,R)=>function(x,k,$,j){return b(this,null,function*(){let z=k.view.da($);z.Xi&&(z=yield bh(x.localStore,k.query,!1).then(({documents:v})=>k.view.da(v,z)));let X=j&&j.targetChanges.get(k.targetId),ye=j&&j.targetMismatches.get(k.targetId)!=null,Q=k.view.applyChanges(z,x.isPrimaryClient,X,ye);return Ph(x,k.targetId,Q.fa),Q.snapshot})}(n,T,S,R);let o=yield bh(n.localStore,e,!0),a=new fc(e,o.hs),l=a.da(o.documents),h=Tr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),f=a.applyChanges(l,n.isPrimaryClient,h);Ph(n,t,f.fa);let m=new pc(e,t,a);return n.ba.set(e,m),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),f.snapshot})}function ay(n,e,t){return b(this,null,function*(){let r=F(n),i=r.ba.get(e),o=r.Da.get(i.targetId);if(o.length>1)return r.Da.set(i.targetId,o.filter(a=>!ns(a,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Xa(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Uc(r.remoteStore,i.targetId),_c(r,i.targetId)}).catch(Nr))):(_c(r,i.targetId),yield Xa(r.localStore,i.targetId,!0))})}function cy(n,e){return b(this,null,function*(){let t=F(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Uc(t.remoteStore,r.targetId))})}function uy(n,e,t){return b(this,null,function*(){let r=gy(n);try{let i=yield function(a,l){let h=F(a),f=he.now(),m=l.reduce((R,N)=>R.add(N.key),q()),T,S;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let N=rt(),x=q();return h.os.getEntries(R,m).next(k=>{N=k,N.forEach(($,j)=>{j.isValidDocument()||(x=x.add($))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,N)).next(k=>{T=k;let $=[];for(let j of l){let z=p_(j,T.get(j.key).overlayedDocument);z!=null&&$.push(new it(j.key,z,Lh(z.value.mapValue),vt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,f,$,l)}).next(k=>{S=k;let $=k.applyToLocalDocumentSet(T,x);return h.documentOverlayCache.saveOverlays(R,k.batchId,$)})}).then(()=>({batchId:S.batchId,changes:Gh(T)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,h){let f=a.xa[a.currentUser.toKey()];f||(f=new ne(H)),f=f.insert(l,h),a.xa[a.currentUser.toKey()]=f}(r,i.batchId,t),yield Vr(r,i.changes),yield os(r.remoteStore)}catch(i){let o=jc(i,"Failed to persist write");t.reject(o)}})}function yd(n,e){return b(this,null,function*(){let t=F(n);try{let r=yield M_(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Fa.get(o);a&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?Y(a.wa):i.removedDocuments.size>0&&(Y(a.wa),a.wa=!1))}),yield Vr(t,r,e)}catch(r){yield Nr(r)}})}function Ch(n,e,t){let r=F(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((o,a)=>{let l=a.view.j_(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){let h=F(a);h.onlineState=l;let f=!1;h.queries.forEach((m,T)=>{for(let S of T.U_)S.j_(l)&&(f=!0)}),f&&zc(h)}(r.eventManager,e),i.length&&r.Sa.h_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function ly(n,e,t){return b(this,null,function*(){let r=F(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),o=i&&i.key;if(o){let a=new ne(L.comparator);a=a.insert(o,xe.newNoDocument(o,U.min()));let l=q().add(o),h=new xi(U.min(),new Map,new ne(H),a,l);yield yd(r,h),r.va=r.va.remove(o),r.Fa.delete(e),Gc(r)}else yield Xa(r.localStore,e,!1).then(()=>_c(r,e,t)).catch(Nr)})}function hy(n,e){return b(this,null,function*(){let t=F(n),r=e.batch.batchId;try{let i=yield L_(t.localStore,e);Id(t,r,null),vd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Vr(t,i)}catch(i){yield Nr(i)}})}function dy(n,e,t){return b(this,null,function*(){let r=F(n);try{let i=yield function(a,l){let h=F(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,l).next(T=>(Y(T!==null),m=T.keys(),h.mutationQueue.removeMutationBatch(f,T))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,e);Id(r,e,t),vd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Vr(r,i)}catch(i){yield Nr(i)}})}function vd(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function Id(n,e,t){let r=F(n),i=r.xa[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function _c(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Vr(e).forEach(r=>{n.Ma.containsKey(r)||wd(n,r)})}function wd(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(Uc(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),Gc(n))}function Ph(n,e,t){for(let r of t)r instanceof Wi?(n.Ma.addReference(r.key,e),fy(n,r)):r instanceof Hi?(O("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||wd(n,r.key)):M()}function fy(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(O("SyncEngine","New document in limbo: "+t),n.Ca.add(r),Gc(n))}function Gc(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new L(se.fromString(e)),r=n.Na.next();n.Fa.set(r,new mc(t)),n.va=n.va.insert(t,r),hd(n.remoteStore,new Ar(qe(Mc(t.path)),r,"TargetPurposeLimboResolution",Oh.oe))}}function Vr(n,e,t){return b(this,null,function*(){let r=F(n),i=[],o=[],a=[];r.ba.isEmpty()||(r.ba.forEach((l,h)=>{a.push(r.Ba(h,e,t).then(f=>{if((f||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(h.targetId,f?.fromCache?"not-current":"current"),f){i.push(f);let m=Ha.Ki(h.targetId,f);o.push(m)}}))}),yield Promise.all(a),r.Sa.h_(i),yield function(h,f){return b(this,null,function*(){let m=F(h);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",T=>P.forEach(f,S=>P.forEach(S.qi,R=>m.persistence.referenceDelegate.addReference(T,S.targetId,R)).next(()=>P.forEach(S.Qi,R=>m.persistence.referenceDelegate.removeReference(T,S.targetId,R)))))}catch(T){if(!Or(T))throw T;O("LocalStore","Failed to update sequence numbers: "+T)}for(let T of f){let S=T.targetId;if(!T.fromCache){let R=m.ns.get(S),N=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(N);m.ns=m.ns.insert(S,x)}}})}(r.localStore,o))})}function py(n,e){return b(this,null,function*(){let t=F(n);if(!t.currentUser.isEqual(e)){O("SyncEngine","User change. New user:",e.toKey());let r=yield ud(t.localStore,e);t.currentUser=e,function(o,a){o.Oa.forEach(l=>{l.forEach(h=>{h.reject(new V(C.CANCELLED,a))})}),o.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Vr(t,r.us)}})}function my(n,e){let t=F(n),r=t.Fa.get(e);if(r&&r.wa)return q().add(r.key);{let i=q(),o=t.Da.get(e);if(!o)return i;for(let a of o){let l=t.ba.get(a);i=i.unionWith(l.view.Ea)}return i}}function Ed(n){let e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=yd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=my.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ly.bind(null,e),e.Sa.h_=ny.bind(null,e.eventManager),e.Sa.ka=ry.bind(null,e.eventManager),e}function gy(n){let e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=hy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=dy.bind(null,e),e}var Qi=class{constructor(){this.synchronizeTabs=!1}initialize(e){return b(this,null,function*(){this.serializer=is(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return V_(this.persistence,new Ja,e.initialUser,this.serializer)}createPersistence(e){return new Ga(Wa.Hr,this.serializer)}createSharedClientState(e){return new Za}terminate(){return b(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var yc=class{initialize(e,t){return b(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ch(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=py.bind(null,this.syncEngine),yield Z_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new lc}()}createDatastore(e){let t=is(e.databaseInfo.databaseId),r=function(o){return new nc(o)}(e.databaseInfo);return function(o,a,l,h){return new sc(o,a,l,h)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,o,a,l){return new ac(r,i,o,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Ch(this.syncEngine,t,0),function(){return qi.D()?new qi:new ec}())}createSyncEngine(e,t){return function(i,o,a,l,h,f,m){let T=new gc(i,o,a,l,h,f);return m&&(T.La=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return b(this,null,function*(){var e;yield function(r){return b(this,null,function*(){let i=F(r);O("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield xr(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var vc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):tt("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Ic=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ue.UNAUTHENTICATED,this.clientId=Ci.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,o=>b(this,null,function*(){O("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(O("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ue;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>b(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=jc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Jo(n,e){return b(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>b(this,null,function*(){r.isEqual(i)||(yield ud(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Dh(n,e){return b(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield yy(n);O("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Sh(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Sh(e.remoteStore,i)),n._onlineComponents=e})}function _y(n){return n.name==="FirebaseError"?n.code===C.FAILED_PRECONDITION||n.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function yy(n){return b(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Jo(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!_y(t))throw t;dn("Error using user provided cache. Falling back to memory cache: "+t),yield Jo(n,new Qi)}}else O("FirestoreClient","Using default OfflineComponentProvider"),yield Jo(n,new Qi);return n._offlineComponents})}function Td(n){return b(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O("FirestoreClient","Using user provided OnlineComponentProvider"),yield Dh(n,n._uninitializedComponentsProvider._online)):(O("FirestoreClient","Using default OnlineComponentProvider"),yield Dh(n,new yc))),n._onlineComponents})}function vy(n){return Td(n).then(e=>e.syncEngine)}function Iy(n){return b(this,null,function*(){let e=yield Td(n),t=e.eventManager;return t.onListen=iy.bind(null,e.syncEngine),t.onUnlisten=ay.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=sy.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=cy.bind(null,e.syncEngine),t})}function wy(n,e,t={}){let r=new Ue;return n.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){return function(o,a,l,h,f){let m=new vc({next:S=>{a.enqueueAndForget(()=>ty(o,T));let R=S.docs.has(l);!R&&S.fromCache?f.reject(new V(C.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&S.fromCache&&h&&h.source==="server"?f.reject(new V(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(S)},error:S=>f.reject(S)}),T=new dc(Mc(l.path),m,{includeMetadataChanges:!0,ra:!0});return ey(o,T)}(yield Iy(n),n.asyncQueue,e,t,r)})),r.promise}function Ad(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var kh=new Map;function Ey(n,e,t){if(!t)throw new V(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ty(n,e,t,r){if(e===!0&&r===!0)throw new V(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Nh(n){if(!L.isDocumentKey(n))throw new V(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Kc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M()}function An(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Kc(n);throw new V(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Ji=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new V(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new V(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ty("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ad((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Rr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ji({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new V(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new V(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ji(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Yo;switch(r.type){case"firstParty":return new ta(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=kh.get(t);r&&(O("ComponentProvider","Removing Datastore"),kh.delete(t),r.terminate())}(this),Promise.resolve()}};function bd(n,e,t,r={}){var i;let o=(n=An(n,Rr))._getSettings(),a=`${e}:${t}`;if(o.host!=="firestore.googleapis.com"&&o.host!==a&&dn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=ue.MOCK_USER;else{l=vl(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new V(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new ue(f)}n._authCredentials=new Xo(new Ri(l,h))}}var wc=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},De=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Cr=class n extends wc{constructor(e,t,r){super(e,t,Mc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new De(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Sd(n,e,...t){if(n=Ve(n),arguments.length===1&&(e=Ci.newId()),Ey("doc","path",e),n instanceof Rr){let r=se.fromString(e,...t);return Nh(r),new De(n,null,new L(r))}{if(!(n instanceof De||n instanceof Cr))throw new V(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return Nh(r),new De(n.firestore,n instanceof Cr?n.converter:null,new L(r))}}var Ec=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new $i(this,"async_queue_retry"),this.hu=()=>{let t=Qo();t&&O("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};let e=Qo();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Qo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ue;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return b(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!Or(e))throw e;O("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw tt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=cc.createAndSchedule(this,e,t,r,o=>this.Eu(o));return this._u.push(i),i}Pu(){this.au&&M()}verifyOperationInProgress(){}du(){return b(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};var bn=class extends Rr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Ec}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Pd(this),this._firestoreClient.terminate()}};function Rd(n,e){let t=typeof n=="object"?n:nr(),r=typeof n=="string"?n:e||"(default)",i=wo(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=_l("firestore");o&&bd(i,...o)}return i}function Cd(n){return n._firestoreClient||Pd(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Pd(n){var e,t,r;let i=n._freezeSettings(),o=function(l,h,f,m){return new oa(l,h,f,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Ad(m.experimentalLongPollingOptions),m.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Ic(n._authCredentials,n._appCheckCredentials,n._queue,o),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Pr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ee.fromBase64String(e))}catch(t){throw new V(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Dr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Yi=class{constructor(e){this._methodName=e}};var kr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}};var Ay=/^__.*__$/,Tc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new it(e,this.data,this.fieldMask,t,this.fieldTransforms):new jt(e,this.data,t,this.fieldTransforms)}};function Dd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}var Ac=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.mu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Xi(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(Dd(this.fu)&&Ay.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},bc=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||is(e)}Fu(e,t,r,i=!1){return new Ac({fu:e,methodName:t,vu:r,path:Re.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function by(n){let e=n._freezeSettings(),t=is(n._databaseId);return new bc(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Sy(n,e,t,r,i,o={}){let a=n.Fu(o.merge||o.mergeFields?2:0,e,t,i);xd("Data must be an object, but it was:",a,r);let l=Nd(r,a),h,f;if(o.merge)h=new Fe(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){let m=[];for(let T of o.mergeFields){let S=Ry(e,T,t);if(!a.contains(S))throw new V(C.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);Py(m,S)||m.push(S)}h=new Fe(m),f=a.fieldTransforms.filter(T=>h.covers(T.field))}else h=null,f=a.fieldTransforms;return new Tc(new Oe(l),h,f)}function kd(n,e){if(Od(n=Ve(n)))return xd("Unsupported field value:",e,n),Nd(n,e);if(n instanceof Yi)return function(r,i){if(!Dd(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let o=[],a=0;for(let l of r){let h=kd(l,i.bu(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=Ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return u_(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=he.fromDate(r);return{timestampValue:Fi(i.serializer,o)}}if(r instanceof he){let o=new he(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Fi(i.serializer,o)}}if(r instanceof kr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pr)return{bytesValue:nd(i.serializer,r._byteString)};if(r instanceof De){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Fc(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Kc(r)}`)}(n,e)}function Nd(n,e){let t={};return xh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Rn(n,(r,i)=>{let o=kd(i,e.pu(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Od(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof he||n instanceof kr||n instanceof Pr||n instanceof De||n instanceof Yi)}function xd(n,e,t){if(!Od(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Kc(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function Ry(n,e,t){if((e=Ve(e))instanceof Dr)return e._internalPath;if(typeof e=="string")return Vd(n,e);throw Xi("Field path arguments must be of type string or ",n,!1,void 0,t)}var Cy=new RegExp("[~\\*/\\[\\]]");function Vd(n,e,t){if(e.search(Cy)>=0)throw Xi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Dr(...e.split("."))._internalPath}catch{throw Xi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xi(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new V(C.INVALID_ARGUMENT,l+n+h)}function Py(n,e){return n.some(t=>t.isEqual(e))}var Zi=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new De(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Sc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Ld("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Sc=class extends Zi{data(){return super.data()}};function Ld(n,e){return typeof e=="string"?Vd(n,e):e instanceof Dr?e._internalPath:e._delegate._internalPath}var Rc=class{convertValue(e,t="none"){switch(Bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(It(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw M()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Rn(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertGeoPoint(e){return new kr(te(e.latitude),te(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Oc(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ir(e));default:return null}}convertTimestamp(e){let t=nt(e);return new he(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=se.fromString(e);Y(cd(r));let i=new Ni(r.get(1),r.get(3)),o=new L(r.popFirst(5));return i.isEqual(t)||tt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function Dy(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Cc=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},es=class extends Zi{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Pc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Ld("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Pc=class extends es{data(e={}){return super.data(e)}};function Md(n){n=An(n,De);let e=An(n.firestore,bn);return wy(Cd(e),n._key).then(t=>ky(e,n,t))}var Dc=class extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}};function Fd(n,e,t){n=An(n,De);let r=An(n.firestore,bn),i=Dy(n.converter,e,t);return Bd(r,[Sy(by(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,vt.none())])}function Ud(n){return Bd(An(n.firestore,bn),[new Er(n._key,vt.none())])}function Bd(n,e){return function(r,i){let o=new Ue;return r.asyncQueue.enqueueAndForget(()=>b(this,null,function*(){return uy(yield vy(r),i,o)})),o.promise}(Cd(n),e)}function ky(n,e,t){let r=t.docs.get(e._key),i=new Dc(n);return new es(n,i,e._key,r,new Cc(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Sn=i})(nn),gt(new Pe("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),l=new bn(new Zo(r.getProvider("auth-internal")),new ra(r.getProvider("app-check-internal")),function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new V(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ni(f.options.projectId,m)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),ce(oh,"4.6.2",e),ce(oh,"4.6.2","esm2017")})();var Lr=class{constructor(e){return e}},qd="firestore",Wc=class{constructor(){return ir(qd)}};var Hc=new Jt("angularfire2.firestore-instances");function Ny(n,e){let t=Ao(qd,n,e);return t&&new Lr(t)}function Oy(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Lr(r)}}var xy={provide:Wc,deps:[[new dt,Hc]]},Vy={provide:Lr,useFactory:Ny,deps:[[new dt,Hc],Ot]};function ME(n,...e){return ce("angularfire",sn.full,"fst"),Xt([Vy,xy,{provide:Hc,useFactory:Oy(n),multi:!0,deps:[He,ft,sr,or,[new dt,Ii],[new dt,rr],...e]}])}var FE=Ze(Ud,!0);var UE=Ze(Sd,!0);var BE=Ze(Md,!0);var qE=Ze(Rd,!0);var $E=Ze(Fd,!0);export{Pt as a,Ly as b,My as c,ti as d,ol as e,al as f,Fy as g,dl as h,nv as i,Gv as j,Kv as k,he as l,Lr as m,ME as n,FE as o,UE as p,BE as q,qE as r,$E as s};
